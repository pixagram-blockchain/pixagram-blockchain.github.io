(self.webpackChunkpixa_pics=self.webpackChunkpixa_pics||[]).push([["src_js_pages_Feed_js"],{71420:(e,t,n)=>{"use strict";var o,r,s,i,a,l;n.d(t,{A:()=>p}),o=n(15299),r=n(58640),s=n(29134),(0,r.A)().then((function(e){i=e})),a=new Set,l={};let c="OffscreenCanvas"in window||"OffscreenCanvas"in self,d=null;c?d=new OffscreenCanvas(1,1):(d=document.createElement("canvas"),d.width=1,d.height=1);let h=d.getContext("2d",{willReadFrequently:!0});const u=(()=>{const e=e=>void 0!==i?i.h64ToString(e,BigInt(6711159)).toString():s.h64.init(BigInt(6711159)).update(e).digest().toString(),t=e=>a.has(e);return{has:t,get_new_img_obj:(n,o)=>{const r=e(n);t(r)?o(l[r]):((e,t)=>{let n={id:t},r=new Image;r.onload=()=>{var e;d.width=r.naturalWidth,d.height=r.naturalHeight,h.drawImage(r,0,0),n.width=r.naturalWidth,n.height=r.naturalHeight,n.image_data=h.getImageData(0,0,n.width,n.height),(e=>{a.add(e.id),l[e.id]=e})(e=n),o(e)},r.decoding="async",r.src=e})(n,r)},get_id:e}})();class _ extends o.default.PureComponent{constructor(e){super(e),this.st4te={className:e.className,items:e.items,keyMapper:e.keyMapper,image:e.image,children:e.children,ids:(e.items||[]).map((e=>e.id)).join("-"),itemsWithSizes:[],itemsWithSizesComputed:[]}}setSt4te(e,t){e=e||{},this.st4te=Object.assign(this.st4te,e),t()}componentWillReceiveProps(e){let{items:t,image:n}=e;const o=(t||[]).map((e=>e.id)).join("-")!==this.st4te.ids,r=o?[]:this.st4te.itemsWithSizes;this.setSt4te({...e,itemsWithSizes:r,itemsWithSizesComputed:o?[]:this.st4te.itemsWithSizesComputed||[]},(()=>{o&&(this.maybe_render(),t.forEach(((e,t)=>{this.st4te.itemsWithSizesComputed[t]||u.get_new_img_obj(n(e),(n=>{this._on_size_computed(n,t,e)}))})))}))}_on_size_computed=(e,t,n)=>{let{itemsWithSizes:o,itemsWithSizesComputed:r}=this.st4te;o[t]={size:e,item:n},r[t]=!0,this.setSt4te({itemsWithSizesComputed:r,itemsWithSizes:o},(()=>{this.maybe_render()}))};maybe_render=()=>{const{items:e,itemsWithSizesComputed:t}=this.st4te;(t||{}).length===(e||{}).length&&this.forceUpdate()};render(){const{itemsWithSizes:e,children:t,className:n}=this.st4te;return o.default.createElement("div",{className:n},t(e))}}const p=_},78725:(e,t,n)=>{"use strict";var o,r,s,i,a,l,c,d,h,u,_,p,f,m,g,x;n.d(t,{A:()=>b}),o=n(15299),r=n(79626),s=n(20426),i=n(67520),a=n(91004),l=n(42460),c=n(88104),d=n(96232),h=n(67114),u=n(61428),_=n(39756),p=n(95523),f=n(37532),m=n(86982),g=n(17688),x=n(69205);class y extends o.default.PureComponent{constructor(e){super(e),this.st4te={classes:e.classes,data:e.data,timeAgo:f.A,renderer:e.renderer,nsfw:e.nsfw,size:e.size,visible:e.visible,is_scrolling:e.is_scrolling,selected:e.selected,image_height:e.image_height||0,image_width:e.image_width||0,column_width:e.column_width,key:e.key,id:e.id,rowIndex:e.rowIndex,columnIndex:e.columnIndex,style:e.style||{},_history:m.Vv,_init:!1,_canvas:null,_image:null,_imagePreload:null,_root:void 0,width:0,height:0,_has_been_visible:!1}}componentWillReceiveProps(e){var t=!this.st4te._init,n=e.renderer!==this.st4te.renderer,o=e.id!==this.st4te.id,r=e.is_scrolling!==this.st4te.is_scrolling,s=e.nsfw!==this.st4te.nsfw,i=e.visible!==this.st4te.visible,a=e.column_width!==this.st4te.column_width,l=e.style.top!==this.st4te.style.top||e.style.left!==this.st4te.style.left||a,c=e.selected!==this.st4te.selected,d=e.locales!==this.st4te.locales,h=()=>{(n||t||s||a)&&this._set_size()};(t||n||i||o||r||s||l||c||d)&&this.setSt4te({...e,_has_been_visible:i||this.st4te._has_been_visible,_init:!0},(()=>{if(t||n||s||i||r||c||d)this.forceUpdate(h);else if(l)if(void 0!==this.st4te._root){var o=e.style;this.st4te._root.style.width=o.width+"px",this.st4te._root.style.height=o.height+"px",this.st4te._root.style.left=o.left+"px",this.st4te._root.style.top=o.top+"px",h()}else this.forceUpdate(h)}))}setSt4te=(e,t)=>{this.st4te=Object.assign(this.st4te,e),"function"==typeof t&&t()};_set_root_ref=e=>{null!==e&&this.setSt4te({_root:e})};setCanvasRef=e=>{if(void 0!==e&&null!=e&&void 0!==e.width&&null!=e.width&&"function"==typeof e.getContext){var t=e;t.context=e.getContext("2d",{willReadFrequently:!0}),this.setSt4te({_canvas:t},(()=>{this._set_size()}))}};_set_imgd=e=>{const t=this.st4te._canvas;createImageBitmap(e).then((function(e){t.style.aspectRatio=`${e.width} / ${e.height}`,t.width=e.width,t.height=e.height,t.context.drawImage(e,0,0),e.close()}))};_render_hex=()=>{const e=Math.max(Math.min(12,600/this.st4te.size.width/2),3);(0,p.eu)(this.st4te.size.image_data,e,this._set_imgd,!0,this.st4te.id)};_render_smooth=()=>{const e=Math.max(Math.min(6,600/this.st4te.size.width|0),2);(0,p.px)(this.st4te.size.image_data,e,this._set_imgd,!0,this.st4te.id)};_render_crt=()=>{const e=Math.max(Math.min(6,600/this.st4te.size.width|0),2);(0,p.E6)(this.st4te.size.image_data,e,this._set_imgd,!0,this.st4te.id)};_render_square=()=>{this._set_imgd(this.st4te.size.image_data)};_set_size=()=>{"hexagon"===this.st4te.renderer?this._render_hex():"xbrz"===this.st4te.renderer?this._render_smooth():"crt"===this.st4te.renderer?this._render_crt():this._render_square()};_open_auhtor=e=>{this.st4te._history.push("/@"+e)};_can_not_open_nsfw=()=>{x.Le("Mature content is disabled"),setTimeout((()=>{x.Le("Edit your settings for enabling NSFW content")}),3250)};render(){const{classes:e,width:t,height:n,nsfw:r,renderer:p,style:m,id:x,image_height:y,image_width:b,locales:w,selected:A,is_scrolling:v,_has_been_visible:S}=this.st4te,C=this.st4te.data||{},E=(C.upVotesNumber,C.upVotesNumber,C.downVotesNumber,C.downVotesNumber,parseFloat((C.payout||"").replace("$",""))),R=parseFloat(1*E/3).toFixed(2),B=parseFloat(2*E/3).toFixed(2),k=v?{pointerEvents:"none",touchActions:"pan-y"}:{},D=C.author||{};return o.default.createElement(s.A,{ref:this._set_root_ref,key:x,className:e.card+(A?" Mui-selected":""),style:{...m,...k}},o.default.createElement(i.A,{className:e.cardHeader,avatar:o.default.createElement(a.A,{onClick:e=>{this._open_auhtor(D.username)},src:D.image}),action:o.default.createElement(l.A,{onClick:e=>{this.props.onMenuClick(e,C)}},o.default.createElement(h.A,{style:{color:"#666"}})),title:o.default.createElement("span",{onClick:e=>this.props.onOpen(C)},C.title),subheader:o.default.createElement("span",null,o.default.createElement(d.Ay,{arrow:!0,title:new Date(C.date).toLocaleDateString(w,{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})},o.default.createElement("span",{className:e.subheaderDate},f.A.format(C.date||Date.now()))),o.default.createElement("span",{className:e.subheaderBy}," by "),o.default.createElement(d.Ay,{title:"@"+(C.author||{}).username},o.default.createElement("span",{className:e.subheaderName,onClick:e=>{this._open_auhtor(D.username)}},(D||{}).name)))}),o.default.createElement(g.A,{style:{width:"100%",borderRadius:"12px"},key:(C.nsfw&&!r?"nsfw":"sfw")+"-"+p},o.default.createElement("canvas",{ref:this.setCanvasRef,className:e.image+("square"===p?" pixelated":""),width:t||b,height:n||y,onClick:e=>{!C.nsfw||r?this.props.onOpen(C):this._can_not_open_nsfw()},style:{filter:C.nsfw&&!r?"blur(24px)":"none",aspectRatio:`${t||b} / ${n||y}`}})),o.default.createElement(c.A,{disableSpacing:!0,style:e.actions},o.default.createElement(l.A,{"aria-label":"Up-Vote"},o.default.createElement(u.A,{style:{transform:"rotate(-90deg)",color:"#999"}})),C.upVotesNumber,o.default.createElement(l.A,{"aria-label":"Down-Vote"},o.default.createElement(u.A,{style:{transform:"rotate(90deg)",color:"#999"}})),C.downVotesNumber,o.default.createElement(d.Ay,{arrow:!0,title:"Curators: "+R+" PS + Author: "+B+" PS"},o.default.createElement("span",{className:e.payout},parseFloat(C.payout).toFixed(2)," ",o.default.createElement(_.A,{style:{width:"24px",height:"24px",verticalAlign:"bottom"}})))))}}const b=(0,r.default)((e=>({card:{width:"100%",borderRadius:"21px",marginTop:"24px",userSelect:"none","&.MuiCard-root":{overflow:"hidden",backgroundColor:"#101010",transition:"all 225ms cubic-bezier(0.4, 0, 0.2, 1) 75ms"},"&.MuiCard-root:hover":{backgroundColor:"#000000",contain:"inherit",boxShadow:"0px 2px 4px -1px rgb(0 0 0 / 20%), 0px 4px 5px 0px rgb(0 0 0 / 14%), 0px 1px 10px 0px rgb(0 0 0 / 12%)",transition:"all 150ms cubic-bezier(0.4, 0, 0.2, 1) 5ms"}},subheaderName:{color:"#fff",cursor:"pointer"},subheaderBy:{color:"#aaa"},subheaderDate:{color:"#ddd"},image:{width:"100%",borderRadius:"12px",cursor:"pointer",userSelect:"none",contain:"style layout"},payout:{marginLeft:"auto",marginRight:12,color:e.palette.primary.actionLighter,fontSize:"16px",marginBottom:"4px",fontWeight:"bold"},actions:{color:"#666"},cardHeader:{"& .MuiCardHeader-title":{fontWeight:"bold",fontFamily:'"Industry Book", "Normative Pro"',color:"#fff",cursor:"pointer"},"& .MuiAvatar-root":{cursor:"pointer",borderRadius:"16px"}}})))(y)},23563:(e,t,n)=>{"use strict";var o,r,s,i,a,l,c,d,h,u,_;n.d(t,{A:()=>f}),o=n(15299),r=n(79626),s=n(84630),i=n(19008),a=n(61466),l=n(77430),c=n(48085),d=n(68048),h=n(82133),u=n(41068),_=n(46577);class p extends o.default.PureComponent{constructor(e){super(e),this.state={classes:e.classes,data:e.data,xy:e.xy||[]}}componentWillReceiveProps(e){this.setState(e,(()=>{this.forceUpdate()}))}render(){const{xy:e,classes:t}=this.state,n=0|e[0],r=0|e[1];return o.default.createElement(c.A,{className:t.menu,PaperProps:{style:{overflowY:"overlay",contain:"paint style layout",scrollBehavior:"smooth",userSelect:"none",pointerEvents:r||n?"all":"none"}},onContextMenu:function(e){e.preventDefault()},MenuListProps:{dense:!0},transitionDuration:{enter:125,exit:250},open:!!r||!!n,onClose:this.props.onClose,disablePortal:!1,keepMounted:!0,anchorReference:"anchorPosition",anchorPosition:{top:0|r,left:0|n}},o.default.createElement(i.A,null,o.default.createElement(s.A,null,o.default.createElement(a.A,null,o.default.createElement(d.A,{fontSize:"small"})),o.default.createElement(l.A,{primary:"Favorite"})),o.default.createElement(s.A,null,o.default.createElement(a.A,null,o.default.createElement(h.A,{fontSize:"small"})),o.default.createElement(l.A,{primary:"Share"})),o.default.createElement(s.A,null,o.default.createElement(a.A,null,o.default.createElement(_.A,{fontSize:"small"})),o.default.createElement(l.A,{primary:"Votes"})),o.default.createElement(s.A,null,o.default.createElement(a.A,null,o.default.createElement(u.A,{fontSize:"small"})),o.default.createElement(l.A,{primary:"Details"}))))}}const f=(0,r.default)((e=>({})))(p)},28379:(e,t,n)=>{"use strict";async function o(e){return new Promise((function(t,n){var o=new Image;o.onload=function(){var e,n,r,s,i=function(e,t){let n;try{if("undefined"==typeof OffscreenCanvas)throw Error("OffscreenCanvas not supported");n=new OffscreenCanvas(e,t)}catch(o){n=document.createElement("canvas"),n.width=e,n.height=t}return n}(o.naturalWidth||o.width,o.naturalHeight||o.height),a=i.getContext("2d");a.drawImage(o,0,0),e=a.getImageData(0,0,i.width,i.height),n=new m.Colors(e.data.buffer).get_deduplicated_sorted_uint32a(),r=new m.Colors(n.buffer).get_hex(),s={imgd:a.getImageData(0,0,i.width,i.height),colors:r,width:i.width,height:i.height},t(s)},o.onabort=n,o.src=e}))}var r,s,i,a,l,c,d,h,u,_,p,f,m,g,x,y,b,w,A,v,S,C,E,R,B,k,D,P,L,I,U,T,z,M,j,N,O,W,F;n.d(t,{A:()=>H}),r=n(15299),s=n(79626),i=n(20426),a=n(53058),l=n(6272),c=n(54392),d=n(73486),h=n(50384),u=n(29514),_=n(77430),p=n(71846),f=n(96232),m=n(4826),g=n(91004),x=n(42460),y=n(73546),b=n(67520),w=n(37532),A=n(47026),v=n(56494),S=n(86074),C=n(42561),E=n(88104),R=n(61428),B=n(39756),k=n(82293),D=n(99537),P=n(95523),L=n(59023),I=n(86809),U=n(16526),T=n(69232),z=n(86982),M=n(33615),j=n(13045),N=n(70100),O=n(47625),W=n(61466),F=n(45152);const q=e=>({backdrop:{zIndex:e.zIndex.drawer+1,backdropFilter:"blur(9px) grayscale(1)"},drawer:{width:384,[e.breakpoints.down("sm")]:{width:"100%"}},drawerPaper:{padding:"16px 16px"},colorBadges:{width:"100%",display:"flex",flexWrap:"wrap",gap:"8px",justifyContent:"flex-start",padding:"0px"},colorBadge:{display:"flex",width:24,height:24,borderRadius:"8px",cursor:"pointer"},cardHeader:{"& .MuiCardHeader-title":{fontWeight:"bold",fontFamily:'"Industry Book", "Normative Pro"',color:"#fff",cursor:"pointer"},"& .MuiAvatar-root":{cursor:"pointer",borderRadius:"16px"}},subheaderName:{color:"#fff",cursor:"pointer"},subheaderBy:{color:"#aaa"},subheaderDate:{color:"#ddd"},image:{width:"100%",cursor:"pointer",userSelect:"none",contain:"style layout"},payout:{marginLeft:"auto",marginRight:12,color:e.palette.primary.actionLighter,fontSize:"16px",marginBottom:"4px",fontWeight:"bold"},actions:{color:"#666"},hidden:{filter:"opacity(0)",transform:"scale(.3)",transition:"transform 25ms cubic-bezier(0.4, 0, 0.2, 1) 5ms",contain:"paint size style layout"},appear:{filter:"opacity(1)",transform:"scale(1)",transition:"transform 275ms cubic-bezier(0.4, 0, 0.2, 1) 10ms",contain:"paint size style layout"},viewLeft:{width:"calc(100% - 416px)",position:"relative",[e.breakpoints.down("sm")]:{width:"100%"}},viewRight:{width:"416px",padding:"16px",[e.breakpoints.down("sm")]:{width:"100%",height:"100%",position:"fixed",top:"0px",transform:"translateY(0px)",transition:"transform 260ms cubic-bezier(0.4, 0, 0.2, 1) 5ms"}},viewRightHidden:{width:"416px",padding:"16px",[e.breakpoints.down("sm")]:{width:"100%",height:"100%",position:"fixed",bottom:"0px",transform:"translateY(calc(100% - 96px))",transition:"transform 180ms cubic-bezier(0.4, 0, 0.2, 1) 5ms"}},infoButton:{position:"absolute",right:16,bottom:16,display:"none",[e.breakpoints.down("sm")]:{display:"inherit"}},closeButton:{position:"absolute",top:16,right:16,display:"none",[e.breakpoints.down("sm")]:{display:"inherit"}},back:{cursor:"pointer",position:"absolute",left:0,top:"calc(50% - 64px)",width:128,height:128,lineHeight:"128px",verticalAlign:"middle",textAlign:"center",[e.breakpoints.down("sm")]:{width:80,height:80,top:"calc(50% - 40px)"}},forward:{cursor:"pointer",position:"absolute",right:0,top:"calc(50% - 64px)",width:128,height:128,lineHeight:"128px",verticalAlign:"middle",textAlign:"center",[e.breakpoints.down("sm")]:{width:80,height:80,top:"calc(50% - 40px)"}},arrowIcon:{color:"#ffffff24",width:72,height:72,margin:"28px",transition:"color 180ms cubic-bezier(0.4, 0, 0.2, 1) 5ms",[e.breakpoints.down("sm")]:{width:48,height:48,margin:"16px"},"&:hover":{color:"#ffffff60"}},card:{width:"100%",height:"100%",minHeight:"calc(100% + 48px)",borderRadius:"32px !important","& .MuiCardHeader-action":{margin:"0px !important"}},chipTags:{lineHeight:"34px",gap:"8px",width:"100%",display:"flex",padding:"0px",flexWrap:"wrap",justifyContent:"flex-start",marginTop:"12px","& .MuiChip-root":{cursor:"pointer",borderRadius:"12px",backgroundColor:"#1b1b1b",color:"#979797",transition:"background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms"},"& .MuiChip-root:hover":{backgroundColor:"#2a2a2a",color:"#e3e3e3"}}});class V extends r.default.PureComponent{constructor(e){super(e),this.state={classes:e.classes,keepMounted:e.keepMounted||!1,open:e.open,data:e.data,renderer:e.renderer,locales:e.locales,_history:z.Vv,_authors:[],_accordion_expanded:"description",_view_element:{},_view_element_measurement:{},_canvas:null,_size:{},_card_ref:{},_hidden:!0,_zoom_mode:0,_view_mobile_opened:!1,_view_right_mobile_enabled:(window.innerWidth||document.documentElement.clientWidth||(document.body||document.getElementsByTagName("body")[0]).clientWidth)<=960,metadata:{imgd:null,colors:[],width:0,height:0},_card_y_offset:0,_card_y_now:0,_card_y_previous:0,_card_y_moved_at:0}}componentWillReceiveProps(e){var t=e.data.image!==this.state.data.image,n=!1===e.open&&this.state.open;this.setState(e,(()=>{(n||t)&&this.setState({_hidden:!0},(()=>{this.forceUpdate()})),t&&o(e.data.image).then((e=>{setTimeout((()=>{this.setState({metadata:e,_hidden:!1},(()=>{this._computeSize()}))}),90)}))}))}componentDidMount(){(0,T.A)((()=>n.e("src_js_data_authors_js").then(n.bind(n,60209)))).then((e=>{const t=e.default();this.setState({_authors:t},(()=>{this.forceUpdate()}))})),o(this.state.data.image).then((e=>{this.setState({metadata:e},(()=>{this._computeSize()}))})),window.addEventListener("resize",this._computeSize)}componentWillUnmount(){window.removeEventListener("resize",this._computeSize)}_handleAccordion=(e,t)=>{this.setState({_accordion_expanded:this.state._accordion_expanded===t?"":t},(()=>{this.forceUpdate()}))};_votesRenderer=({index:e,key:t,style:n})=>{const o=Object.entries(this.state._authors)[e][1];return r.default.createElement(h.A,{className:q.row,key:t,style:n},r.default.createElement(u.A,null,r.default.createElement(f.Ay,{title:"@"+o.username},r.default.createElement(g.A,{src:o.image,style:{borderRadius:"12px",cursor:"pointer"},className:"pixelated",onClick:e=>{this._open_auhtor(o.username)}}))),r.default.createElement(_.A,{primary:o.name,secondary:"0.1 PS with 100%"}))};_setViewRef=e=>{e&&"function"==typeof e.getBoundingClientRect&&this.setState({_view_element:e},this._computeSize)};_setZoom=()=>{this.setState({_zoom_mode:this.state._zoom_mode+1&3},(()=>{this.forceUpdate()}))};_computeSize=()=>{const e=(window.innerWidth||document.documentElement.clientWidth||(document.body||document.getElementsByTagName("body")[0]).clientWidth)<=960;if(this.state._view_right_mobile_enabled!==e&&this.setState({_view_right_mobile_enabled:e},this.forceUpdate),"function"==typeof this.state._view_element.getBoundingClientRect&&this.state.metadata.width){const e=this.state._view_element.getBoundingClientRect();this.setState({_view_element_measurement:e},(()=>{const{metadata:e,_view_element_measurement:t}=this.state,n=Math.min((t.width-32)/e.width,(t.height-32)/e.height),o={width:e.width*n|0,height:e.height*n|0};this.setState({_size:o},(()=>{this._set_size()}))}))}};setCanvasRef=e=>{if(void 0!==e&&null!=e&&void 0!==e.width&&null!=e.width&&"function"==typeof e.getContext){var t=e;t.context=e.getContext("2d",{willReadFrequently:!0}),this.setState({_canvas:t},(()=>{this._set_size()}))}};_setMenuCardRef=e=>{e&&this.setState({_card_ref:e},(()=>{this.state._card_ref.addEventListener("pointerdown",this._handle_card_pointer_down.bind(this)),this.state._card_ref.addEventListener("pointermove",this._handle_card_pointer_move.bind(this)),this.state._card_ref.addEventListener("pointerup",this._handle_card_pointer_up.bind(this)),this.state._card_ref.addEventListener("pointercancel",this._handle_card_pointer_up.bind(this)),this.state._card_ref.addEventListener("pointerout",this._handle_card_pointer_move.bind(this)),this.state._card_ref.addEventListener("pointerleave",this._handle_card_pointer_move.bind(this))}))};_handle_card_pointer_down=e=>{this.state._view_right_mobile_enabled&&this.setState({_card_y_moved_at:Date.now(),_card_y_previous:e.pageY,_card_y_now:e.pageY,_card_y_offset:this.state._card_y_offset},this.forceUpdate)};_handle_card_pointer_move=e=>{if(!this.state._view_right_mobile_enabled)return;const t=this.state._card_y_offset+(e.pageY-this.state._card_y_now),n=!this.state._view_mobile_opened&&this.state._view_right_mobile_enabled?Math.min(0,t):Math.max(0,t);this.setState({_card_y_moved_at:Date.now(),_card_y_previous:this.state._card_y_now,_card_y_now:e.pageY,_card_y_offset:n},this.forceUpdate)};_handle_card_pointer_up=e=>{if(!this.state._view_right_mobile_enabled)return;const t=!this.state._view_mobile_opened&&this.state._view_right_mobile_enabled;this.setState({_card_y_previous:e.pageY,_card_y_now:e.pageY},(()=>{if(t&&this.state._card_y_offset<-20)this.setState({_view_mobile_opened:!0,_card_y_previous:0,_card_y_now:0,_card_y_offset:0},this.forceUpdate);else if(!t&&this.state._card_y_offset>20)this.setState({_view_mobile_opened:!1,_card_y_previous:0,_card_y_now:0,_card_y_offset:0},this.forceUpdate);else if(0!==this.state._card_y_offset&&(!t&&this.state._card_y_offset<160||t&&this.state._card_y_offset>-160)){const e=()=>{const n=this.state._card_y_offset>=0,o=t?-1:1,r=n?Math.min:Math.max;this.setState({_card_y_offset:r(0,this.state._card_y_offset+o)},(()=>{this.forceUpdate((()=>{0!==this.state._card_y_offset&&requestAnimationFrame(e)}))}))};requestAnimationFrame(e)}}))};_set_imgd=e=>{const t=this.state._canvas;createImageBitmap(e).then((e=>{t.style.aspectRatio=`${e.width} / ${e.height}`,t.width=e.width,t.height=e.height,t.context.drawImage(e,0,0),e.close(),this.setState({_hidden:!1},this.forceUpdate)}))};_render_hex=()=>{const e=Math.max(Math.min(32,this.state._size.width/this.state.metadata.width/2),3);(0,P.eu)(this.state.metadata.imgd,e,(e=>{this._set_imgd(e)}),!0,4294967295*Math.random()|0)};_render_smooth=()=>{const e=Math.max(Math.min(6,this.state._size.width/this.state.metadata.width|0),2);(0,P.px)(this.state.metadata.imgd,e,(e=>{this._set_imgd(e)}),!0,4294967295*Math.random()|0)};_render_crt=()=>{const e=Math.max(Math.min(6,this.state._size.width/this.state.metadata.width|0),2);(0,P.E6)(this.state.metadata.imgd,e,(e=>{this._set_imgd(e)}),!0,4294967295*Math.random()|0)};_render_square=()=>{this._set_imgd(this.state.metadata.imgd)};_set_size=()=>{this.state.metadata.imgd&&("hexagon"===this.state.renderer?this._render_hex():"xbrz"===this.state.renderer?this._render_smooth():"crt"===this.state.renderer?this._render_crt():this._render_square())};_set_menu_open=()=>{this.setState({_view_mobile_opened:!0},this.forceUpdate)};_set_menu_close=()=>{this.state._view_right_mobile_enabled?this.setState({_view_mobile_opened:!1},this.forceUpdate):this.props.onClose()};_onRequestClose=()=>{const{_view_mobile_opened:e,_view_right_mobile_enabled:t}=this.state;e&&t?this._set_menu_close():this.props.onClose()};_open_auhtor=e=>{this.state._history.push("/@"+e)};_set_tag_naviguation=e=>{this.state._history.push("/trending/"+e),this.props.onClose()};render(){const{classes:e,open:t,data:n,metadata:o,locales:s,renderer:u,_hidden:m,_accordion_expanded:P,_view_element_measurement:T,_size:z,_zoom_mode:q,_authors:V,_view_mobile_opened:H,_view_right_mobile_enabled:G,_card_y_offset:X}=this.state,$=(n.upVotesNumber,n.upVotesNumber,n.downVotesNumber,n.downVotesNumber,parseFloat((n.payout||"0$").replace("$",""))||0),J=parseFloat(1*$/3).toFixed(2),Y=parseFloat(2*$/3).toFixed(2),K={left:(T.width-z.width)/2|0,top:(T.height-z.height)/2|0};return r.default.createElement(p.A,null,r.default.createElement(a.A,{open:t,className:e.backdrop},r.default.createElement("div",{style:{width:"100%",height:"100%",display:"flex"}},r.default.createElement("div",{className:e.viewLeft,ref:this._setViewRef},r.default.createElement("div",{style:{position:"absolute",left:0,top:0,width:"100%",height:"100%"},onClick:this._onRequestClose}),r.default.createElement("div",{className:e.back,onClick:this.props.onPrevious},r.default.createElement(L.A,{className:e.arrowIcon})),r.default.createElement("div",{className:e.forward,onClick:this.props.onNext},r.default.createElement(I.A,{className:e.arrowIcon})),r.default.createElement("div",{onClick:this._setZoom,style:{transform:"scale(0.62)",animation:"transform 325ms cubic-bezier(0.4, 0, 0.2, 1) 25ms",position:"absolute",left:K.left,top:K.top,background:"transparent",display:"relative",margin:0}},r.default.createElement("img",{src:n.image,className:m?e.hidden:e.appear,style:{position:"absolute",width:z.width,height:z.height,filter:"blur(120px) brightness(1.2)"}}),r.default.createElement("img",{src:n.image,className:m?e.hidden:e.appear,style:{position:"absolute",width:z.width,height:z.height,filter:"blur(180px) brightness(1.3)"}}),r.default.createElement("canvas",{className:("square"===u?"pixelated":"")+" "+(m?e.hidden:e.appear),ref:this.setCanvasRef,style:{width:z.width,height:z.height}}))),r.default.createElement("div",{className:H||!G?e.viewRight:e.viewRightHidden},r.default.createElement(i.A,{className:e.card,style:{transform:`translateY(${X}px)`}},r.default.createElement(b.A,{ref:this._setMenuCardRef,className:e.cardHeader,avatar:r.default.createElement(g.A,{src:(n.author||{}).image,onClick:e=>{this._open_auhtor(n.author.username)}}),action:r.default.createElement(x.A,{onClick:e=>{H||!G?this._set_menu_close(e):this._set_menu_open()}},H||!G?r.default.createElement(y.A,{style:{color:"#666"}}):r.default.createElement(U.A,{style:{color:"#666"}})),title:n.title,subheader:r.default.createElement("span",null,r.default.createElement(f.Ay,{arrow:!0,title:new Date(n.date).toLocaleDateString(s,{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})},r.default.createElement("span",{className:e.subheaderDate},w.A.format(new Date(n.date||Date.now())))),r.default.createElement("span",{className:e.subheaderBy}," by "),r.default.createElement(f.Ay,{title:"@"+(n.author||{}).username},r.default.createElement("span",{className:e.subheaderName,onClick:e=>{this._open_auhtor(n.author.username)}},(n.author||{}).name)))}),r.default.createElement(l.A,null,r.default.createElement(A.A,{expanded:"description"===P,onChange:e=>{this._handleAccordion(e,"description")}},r.default.createElement(S.A,{expandIcon:r.default.createElement(C.A,null),"aria-controls":"description-content",id:"description-header"},r.default.createElement(c.A,{className:e.heading},"Description")),r.default.createElement(v.A,null,r.default.createElement(c.A,{variant:"body2",color:"textSecondary",component:"p"},"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc auctor nec ante ac aliquam. Nullam auctor commodo ex. In euismod bibendum tellus nec interdum. Nulla mattis quis nibh vel mattis. Vivamus ornare faucibus odio. Mauris sit amet sem posuere, tincidunt eros ac, imperdiet leo. Etiam pharetra suscipit pulvinar. Etiam quis finibus ex, id gravida libero. Duis imperdiet massa sit amet enim posuere porttitor nec eu velit. Proin est magna, pretium et tortor eu, suscipit feugiat leo."),r.default.createElement("div",{className:e.chipTags},["pixa-selfie","lifestyle","hype","demo-tag","be-yourself"].map(((e,t)=>r.default.createElement(M.A,{key:"#".concat(e.concat(t.toString(10))),label:"#".concat(e.toLowerCase()),onClick:()=>this._set_tag_naviguation(e.toLowerCase())})))))),r.default.createElement(A.A,{expanded:"colors"===P,onChange:e=>{this._handleAccordion(e,"colors")}},r.default.createElement(S.A,{expandIcon:r.default.createElement(C.A,null),"aria-controls":"colors-content",id:"colors-header"},r.default.createElement(c.A,{className:e.heading},"Image")),r.default.createElement(v.A,{style:{display:"block"}},r.default.createElement("div",{className:e.colorBadges},o.colors.map(((t,n)=>r.default.createElement(f.Ay,{arrow:!0,title:t},r.default.createElement("div",{key:n,className:e.colorBadge,style:{backgroundColor:t}}))))),r.default.createElement(d.A,null,r.default.createElement(F.A,null,"Metadata"),r.default.createElement(h.A,null,r.default.createElement(W.A,null,r.default.createElement(O.A,null)),r.default.createElement(_.A,null,o.width,"px Width")),r.default.createElement(h.A,null,r.default.createElement(W.A,null,r.default.createElement(N.A,null)),r.default.createElement(_.A,null,o.height,"px Height")),r.default.createElement(h.A,null,r.default.createElement(W.A,null,r.default.createElement(j.A,null)),r.default.createElement(_.A,null,o.colors.length," Colors"))))),r.default.createElement(A.A,{expanded:"nft"===P,onChange:e=>{this._handleAccordion(e,"nft")}},r.default.createElement(S.A,{expandIcon:r.default.createElement(C.A,null),"aria-controls":"nft-content",id:"nft-header"},r.default.createElement(c.A,{className:e.heading},"NFT")),r.default.createElement(v.A,null,r.default.createElement(c.A,{variant:"body2",color:"textSecondary",component:"p"},"Feature available at the launch."))),r.default.createElement(A.A,{expanded:"votes"===P,onChange:e=>{this._handleAccordion(e,"votes")}},r.default.createElement(S.A,{expandIcon:r.default.createElement(C.A,null),"aria-controls":"payout-content",id:"payout-header"},r.default.createElement(c.A,{className:e.heading},"Votes")),r.default.createElement(v.A,null,r.default.createElement(k.A,{disableHeight:!0},(({width:e})=>r.default.createElement(D.Ay,{noRowsRenderer:()=>{},scrollToIndex:()=>{},height:160,overscanRowCount:1,rowCount:Object.keys(V).length,rowHeight:72,rowRenderer:this._votesRenderer,width:e})))))),r.default.createElement(E.A,{disableSpacing:!0,style:e.actions},r.default.createElement(x.A,{"aria-label":"Up-Vote"},r.default.createElement(R.A,{style:{transform:"rotate(-90deg)",color:"#999"}})),n.upVotesNumber,r.default.createElement(x.A,{"aria-label":"Down-Vote"},r.default.createElement(R.A,{style:{transform:"rotate(90deg)",color:"#999"}})),n.downVotesNumber,r.default.createElement(f.Ay,{arrow:!0,title:"Curators: "+J+" PS + Author: "+Y+" PS"},r.default.createElement("span",{className:e.payout},parseFloat(n.payout).toFixed(2)," ",r.default.createElement(B.A,{style:{width:"16px",height:"16px"}})))))))))}}const H=(0,s.default)(q)(V)},61428:(e,t,n)=>{"use strict";var o,r,s;n.d(t,{A:()=>a}),o=n(15299),r=n(41728),s=n(32150);class i extends o.default.PureComponent{constructor(e){super(e)}render(){return o.default.createElement(r.A,this.props,o.default.createElement("path",{d:"M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12M8.6,16.6L13.2,12L8.6,7.4L10,6L16,12L10,18L8.6,16.6Z"}))}}const a=(0,s.A)((e=>({})))(i)},39756:(e,t,n)=>{"use strict";var o,r,s;n.d(t,{A:()=>a}),o=n(15299),r=n(41728),s=n(32150);class i extends o.default.PureComponent{constructor(e){super(e)}render(){return o.default.createElement(r.A,this.props,o.default.createElement("path",{fill:"currentColor","fill-rule":"evenodd",d:"M10.604 20.578c-.002.333.176.538.462.542q.287.004 8.23 0a1.824 1.824 0 0 0 1.824-1.824V4.704a1.824 1.824 0 0 0-1.824-1.824H4.704A1.824 1.824 0 0 0 2.88 4.704v14.592c0 1.007.592 1.824 1.598 1.824.344-.022.441-.238.447-.542q.005-.305 0-2.65V6.012c0-.623.446-1.058 1.073-1.058H18.23c.627 0 .893.435.893 1.058V17.69c0 .623-.129 1.366-.756 1.366q-4.524.016-7.301 0c-.318-.001-.465.218-.462.506.005.452.004.438 0 1.016Zm-2.242-4.484q-.375 0-.642-.267-.268-.267-.268-.643v-.909q0-.193.131-.324t.324-.131h8.186q.193 0 .324.131t.131.324v.909q0 .376-.268.643-.267.267-.642.267H8.362ZM12 12.683q-.409 0-.648.228-.239.227-.875.227-.637 0-.864-.227-.228-.228-.637-.228-.318 0-.517.154-.199.153-.54.244-.182.057-.324-.074-.143-.131-.143-.324t.131-.335q.131-.142.313-.233l.42-.222q.228-.119.66-.119.637 0 .864.227.227.227.637.227.409 0 .648-.227.238-.227.875-.227t.875.227q.239.227.648.227.41 0 .637-.227.227-.227.864-.227.409 0 .648.113.239.114.432.216.182.091.313.239t.131.341q0 .193-.137.324-.136.131-.318.074-.33-.091-.517-.244-.188-.154-.506-.154-.41 0-.66.228-.25.227-.887.227-.636 0-.875-.227-.239-.228-.648-.228Zm0-4.775q.841 0 1.654.154.813.153 1.455.477.643.324 1.041.842.398.517.398 1.256 0 .193-.131.324t-.324.131H7.907q-.193 0-.324-.131t-.131-.324q0-.739.398-1.256.398-.518 1.041-.842.642-.324 1.455-.477.813-.154 1.654-.154Z"}))}}const a=(0,s.A)((e=>({})))(i)},14781:(e,t,n)=>{"use strict";function o(e,t,n){return Math.min(Math.sqrt(n/(e*t)),1)}function r(e,t){let n;try{if("undefined"==typeof OffscreenCanvas)throw Error("OffscreenCanvas not supported");n=new OffscreenCanvas(e,t)}catch(o){n=document.createElement("canvas"),n.width=e,n.height=t}return n}function s(){return s=Object.assign?Object.assign.bind():function(e){var t,n,o;for(t=1;t<arguments.length;t++)for(o in n=arguments[t])({}).hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},s.apply(null,arguments)}var i,a,l,c,d,h,u,_,p,f,m,g,x,y,b,w,A,v,S,C,E,R,B,k,D,P,L,I,U,T,z,M,j,N,O,W,F,q,V,H,G,X,$,J;n.r(t),n.d(t,{default:()=>Le}),i=n(15299),a=n(86982),l=n(79626),c=n(69205),d=n(69232),h=n(95842),u=n(71420),_=n(78725),p=n(67264),f=n(16594),m=n(23563),g=n(9372),x=n(24488),y=n(8728),b=n(96746),w=n(69113),A=n(83182),v=n(54392),S=n(69312),C=n(19904),E=n(15776),R=n(94422),B=n(86330),k=n(39870),D=n(68016),P=n(65816),L=n(44385),I=n(82803),T=(0,(U=n(4826)).SIMDopeCreateConfAdd)({create:{new_of:!0},properties:{uint32:!0,laba:!0,rgbaon4bits:!0,rgbaon6bits:!0,rgbaon8bits:!0,rgbaon12bits:!0,rgbaon16bits:!0,skin:!0},methods:{simplify:!0,get_new_element:!0,get_use_element:!0,set_tail:!0,is_dark:!0,blend_first_with:!0,blend_first_with_tails:!0,blend_all:!0,euclidean_match_with:!0,manhattan_match_with:!0,cie76_match_with:!0,copy:!0}}),M=(z=Math.fround)(1.25),j=z(1.25);const{simdops:Y,Color:K,Colors:Q}=(0,U.SIMDopeCreate)(T),{minus_int:Z,int_not_equal:ee,plus_int:te,plus_uint:ne,minus_uint:oe,multiply_int:re,multiply_uint:se,multiply_uint_4:ie,divide_uint:ae,clamp_uint8:le,clamp_uint32:ce,int_equal:de,uint_less:he,int_less:ue,int_greater_equal:_e,uint_not_equal:pe,uint_less_equal:fe,min_uint:me}=Y;Object.defineProperty((N=function(e){if(e=e||{},!(this instanceof N))return new N(e);e.pxl_colors=e.pxl_colors||new Uint32Array(0),e.pxls=e.pxls||new Uint32Array(0),this.speed=e.speed||"auto",this.new_pxls_="buffer"in e.pxls?new Uint32Array(e.pxls.buffer):Uint32Array.from(e.pxls),this.new_pxl_colors_="buffer"in e.pxl_colors?new Q(e.pxl_colors.buffer):new Q(Uint32Array.from(e.pxl_colors).buffer);var t=0|this.new_pxl_colors_.length;this.new_pxl_colors_is_skin_mask_=new I.SetFixed(0|t),this.set_new_pxl_skin_mask(),this.best_color_number_=e.number_of_color,this.max_cluster_=t>65536?65537:t>16384?4097:t>8192?257:t>512?17:1,this.index_clusters_=Array(this.max_cluster_),this.length_clusters_=new Uint32Array(this.max_cluster_),this.pxl_colors_usage_=new Uint32Array(t),this.all_index_clusters_=new Uint32Array(t),this.clean_pxl_colors_=new Uint32Array(t),this.clean_pxl_colors_lookup_={},this.is_skin_ops_=0,this.match_ops_=0,this.blend_ops_=0,this.remove_duplicate_ops_=0,this.simplify_ops_=0,this.classify_on_x_bits_ops_=0}).prototype,"set_is_skin_ops",{get:function(){return function(e){this.is_skin_ops_=(0|e)>>>0}}}),Object.defineProperty(N.prototype,"set_match_ops",{get:function(){return function(e){this.match_ops_=(0|e)>>>0}}}),Object.defineProperty(N.prototype,"set_blend_ops",{get:function(){return function(e){this.blend_ops_=(0|e)>>>0}}}),Object.defineProperty(N.prototype,"set_remove_duplicate_ops",{get:function(){return function(e){this.remove_duplicate_ops_=(0|e)>>>0}}}),Object.defineProperty(N.prototype,"set_simplify_ops",{get:function(){return function(e){this.simplify_ops_=e}}}),Object.defineProperty(N.prototype,"set_classify_on_x_bits_ops",{get:function(){return function(e){this.classify_on_x_bits_ops_=e}}}),Object.defineProperty(N.prototype,"get_is_skin_ops",{get:function(){return function(){return 0|this.is_skin_ops_}}}),Object.defineProperty(N.prototype,"get_match_ops",{get:function(){return function(){return 0|this.match_ops_}}}),Object.defineProperty(N.prototype,"get_blend_ops",{get:function(){return function(){return 0|this.blend_ops_}}}),Object.defineProperty(N.prototype,"get_remove_duplicate_ops",{get:function(){return function(){return 0|this.remove_duplicate_ops_}}}),Object.defineProperty(N.prototype,"get_simplify_ops",{get:function(){return function(){return this.simplify_ops_}}}),Object.defineProperty(N.prototype,"get_classify_on_x_bits_ops",{get:function(){return function(){return this.classify_on_x_bits_ops_}}}),Object.defineProperty(N.prototype,"reset_deduplicate",{get:function(){return function(e){this.clean_pxl_colors_lookup_={},this.pxl_colors_usage_.fill(0,0,0|e),this.clean_pxl_colors_.fill(0,0,0|e)}}}),Object.defineProperty(N.prototype,"index_of_color_within_cleaned",{get:function(){return function(e){return(0|this.clean_pxl_colors_lookup_[(0|e)>>>0])-1|0}}}),Object.defineProperty(N.prototype,"set_cleaned_pxl_colors",{get:function(){return function(e,t){this.clean_pxl_colors_[(0|e)>>>0]=(0|t)>>>0,this.clean_pxl_colors_lookup_[(0|t)>>>0]=(e+1|0)>>>0}}}),Object.defineProperty(N.prototype,"increase_color_usage",{get:function(){return function(e){this.pxl_colors_usage_[(0|e)>>>0]=(this.pxl_colors_usage_[(0|e)>>>0]+1|0)>>>0}}}),Object.defineProperty(N.prototype,"set_new_pxls",{get:function(){return function(e,t){this.new_pxls_[(0|e)>>>0]=(0|t)>>>0}}}),Object.defineProperty(N.prototype,"set_new_pxl_colors",{get:function(){return function(e){this.new_pxl_colors_=new Q(this.clean_pxl_colors_.buffer.slice(0,ie(0|e))),this.set_new_pxl_skin_mask()}}}),Object.defineProperty(N.prototype,"set_new_pxl_skin_mask",{get:function(){return function(){var e=new K(new ArrayBuffer(4)),t=0|this.new_pxl_colors_.length,n=0;for(this.new_pxl_colors_is_skin_mask_=new I.SetFixed(0|t);(0|n)<(0|t);n=n+1|0)this.new_pxl_colors_.get_use_element(0|n,e).skin&&this.new_pxl_colors_is_skin_mask_.add(0|n);this.set_is_skin_ops(this.get_is_skin_ops()+n|0)}}}),Object.defineProperty(N.prototype,"get_a_new_pxl_color_from_pxl_index",{get:function(){return function(e){return 4294967295&this.new_pxl_colors_.buffer_getUint32(this.new_pxls_[0|e])}}}),Object.defineProperty(N.prototype,"reset_cluster",{get:function(){return function(){this.max_cluster_=this.new_pxl_colors_.length>32786?65537:this.new_pxl_colors_.length>8192?4097:this.new_pxl_colors_.length>4096?257:this.new_pxl_colors_.length>512?17:1,this.length_clusters_.fill(0,0,0|this.max_cluster);for(var e=0;(0|e)<(0|this.max_cluster);e=(e+1|0)>>>0)this.index_clusters_[0|e]=[]}}}),Object.defineProperty(N.prototype,"add_in_indexes_cluster",{get:function(){return function(e,t){this.index_clusters_[(0|e)>>>0].push((0|t)>>>0)}}}),Object.defineProperty(N.prototype,"set_all_cluster_indexes",{get:function(){return function(){for(var e=0,t=0;(0|e)<(0|this.max_cluster);e=(e+1|0)>>>0)this.all_index_clusters_.set(this.index_clusters_[(0|e)>>>0],(0|t)>>>0),t=(t+this.get_length_in_index_clusters(0|e)|0)>>>0}}}),Object.defineProperty(N.prototype,"get_length_in_index_clusters",{get:function(){return function(e){return(0|this.index_clusters_[(0|e)>>>0].length)>>>0}}}),Object.defineProperty(N.prototype,"get_in_cluster_lengths",{get:function(){return function(e){return(0|this.length_clusters_[(0|e)>>>0])>>>0}}}),Object.defineProperty(N.prototype,"get_an_index_in_clusters",{get:function(){return function(e){return(0|this.all_index_clusters_[0|e])>>>0}}}),Object.defineProperty(N.prototype,"get_a_color_usage",{get:function(){return function(e){return(0|this.pxl_colors_usage_[0|e])>>>0}}}),Object.defineProperty(N.prototype,"set_a_color_usage",{get:function(){return function(e,t){return this.pxl_colors_usage_[0|e]=(0|t)>>>0}}}),Object.defineProperty(N.prototype,"get_a_color_usage_percent",{get:function(){return function(e){return this.pxl_colors_usage_[0|e]/this.new_pxls_.length}}}),Object.defineProperty(N.prototype,"get_average_color_usage_percent",{get:function(){return function(e,t){var n,o,r;for(t=0|((t|=0)<(e|=0)?this.pxl_colors_usage_.length:t),n=0,o=0,r=0,o=0|e;(0|o)<(0|t);o=(o+1|0)>>>0)r=(0|this.get_an_index_in_clusters((0|o)>>>0))>>>0,n+=this.pxl_colors_usage_[0|r]/this.new_pxls_.length;return n/(t-e|0)}}}),Object.defineProperty(N.prototype,"get_a_new_pxl_color",{get:function(){return function(e){return this.new_pxl_colors_.get_new_element(0|e)}}}),Object.defineProperty(N.prototype,"is_pxl_color_skin",{get:function(){return function(e){return this.new_pxl_colors_is_skin_mask_.has(0|e)}}}),Object.defineProperty(N.prototype,"max_cluster",{get:function(){return 0|this.max_cluster_}}),Object.defineProperty(N.prototype,"new_pxls_length",{get:function(){return 0|this.new_pxls_.length}}),Object.defineProperty(N.prototype,"new_pxl_colors_length",{get:function(){return 0|this.new_pxl_colors_.length}}),Object.defineProperty(N.prototype,"best_color_number",{get:function(){return 0|this.best_color_number_}}),Object.defineProperty(N.prototype,"get_data",{get:function(){return function(){return Array.of(this.new_pxls_,this.new_pxl_colors_.subarray_uint32(0,this.new_pxl_colors_.length),{deduplicate:this.get_remove_duplicate_ops(),simplify:this.get_simplify_ops(),classify:this.get_classify_on_x_bits_ops(),skin:this.get_is_skin_ops(),blend:this.get_blend_ops(),match:this.get_match_ops()})}}}),N.prototype.output=function(e){var t,n;return e=e||"heap",t=this.get_data(),"heap"==e?((n=new Uint32Array(2+t[0].length+t[1].length))[0]=0|t[0].length,n[1]=0|t[1].length,n.set(t[0],2),n.set(t[1],2+t[0].length),n.buffer):t},N.prototype.deduplicate=function(){var e,t,n,o,r;for(this.set_remove_duplicate_ops(this.get_remove_duplicate_ops()+1|0),this.reset_deduplicate(0|this.new_pxl_colors_length),e=0,t=0,n=0,o=0,r=0|this.new_pxls_length;(0|o)<(0|r);o=(o+1|0)>>>0)t=0|this.get_a_new_pxl_color_from_pxl_index(0|o),-1==(0|(n=0|this.index_of_color_within_cleaned(0|t)))&&(this.set_cleaned_pxl_colors(0|e,0|t),n=0|e,e=e+1|0),this.increase_color_usage(0|n),this.set_new_pxls(0|o,0|n);this.set_new_pxl_colors(e)},N.prototype.clusterize=function(){this.reset_cluster();var e=0;if(65537===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon16bits)>>>0,(0|e)>>>0);else if(4097===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon12bits)>>>0,(0|e)>>>0);else if(257===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon8bits)>>>0,(0|e)>>>0);else if(17===this.max_cluster)for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|e)>>>0).rgbaon4bits)>>>0,(0|e)>>>0);else for(;(0|e)<(0|this.new_pxl_colors_length);e=(e+1|0)>>>0)this.add_in_indexes_cluster(0,(0|e)>>>0);this.max_cluster>1&&this.set_classify_on_x_bits_ops(this.get_classify_on_x_bits_ops()+this.new_pxl_colors_length),this.set_all_cluster_indexes()},N.prototype.process_threshold=function(e,t){var n,o,r,s,i,a,l,c,d,h,u,_,p,f,m,g,x,y,b,w,A,v,S,C,E;for(n=function(e){return 1-Math.pow(1-e,3)}((e=(0|e)>>>0)/100),o=!1,r=[],s=[],i=0,a=0,d=!1,h=!1,u=0,_=0,p=0,f=0,m=0,g=0,w=0,A=0,v=0,S=0,C=0,E=0,b=z((x=n)*j),y=z(x*M);(0|C)<(0|this.max_cluster);C=(C+1|0)>>>0){for(a=(i+((0|this.get_length_in_index_clusters(0|C))>>>0)|0)>>>0,m=this.get_average_color_usage_percent(0|i,0|a),v=0|i;(0|v)<(0|a);v=(v+1|0)>>>0){if(w=(0|this.get_an_index_in_clusters((0|v)>>>0))>>>0,l=this.get_a_new_pxl_color((0|w)>>>0),d=this.is_pxl_color_skin((0|w)>>>0),(0|(u=(0|this.get_a_color_usage((0|w)>>>0))>>>0))>0)for(r=[],S=0|i;(0|S)<(0|a);S=(S+1|0)>>>0)A=(0|this.get_an_index_in_clusters((0|S)>>>0))>>>0,c=this.get_a_new_pxl_color((0|A)>>>0),h=this.is_pxl_color_skin((0|A)>>>0),0|(_=(0|this.get_a_color_usage((0|A)>>>0))>>>0)&&(0|w)!=(0|A)&&(0|d)==(0|h)&&(p=this.get_a_color_usage_percent((0|w)>>>0)/m,f=this.get_a_color_usage_percent((0|A)>>>0)/m,E=z((E=d&&h?b:d||h?y:x)*(1*Math.abs(p-f)+2*(2-(p+f))+8)/11),l[t](c,E)&&(g=z(_/u),o=!0,this.set_a_color_usage(0|A,0),r.push(c),s.push(g)));(0|r.length)>0&&(K.blend_all(l,r,s),r=[],s=[])}i=0|a}return o},N.prototype.round=function(){var e,t;if(this.new_pxl_colors_length>1024){for(e=0|(this.new_pxl_colors_length>32768?4:this.new_pxl_colors_length>32768?3:this.new_pxl_colors_length>16384?2.5:this.new_pxl_colors_length>8192?2:this.new_pxl_colors_length>2048?1.5:(this.new_pxl_colors_length,1)),t=0;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.get_a_new_pxl_color((0|t)>>>0).simplify(e);this.set_simplify_ops(this.get_simplify_ops()+this.new_pxl_colors_length)}},N.prototype.init=function(){return this.deduplicate(),this.clusterize(),this},N.prototype.run=function(){var e,t,n=this.new_pxl_colors_length>6e4?6:this.new_pxl_colors_length>32e3?4:this.new_pxl_colors_length>16e3?2:this.new_pxl_colors_length>8192?1.5:this.new_pxl_colors_length>4096?1:this.new_pxl_colors_length>1024?.5:.1;if(this.new_pxl_colors_length<=this.best_color_number)return this.deduplicate(),this.clusterize(),this;for(e=["manhattan_match_with","euclidean_match_with","euclidean_match_with"],t=this.speed=this.new_pxl_colors_length>16384?e[0]:this.new_pxl_colors_length>256?e[1]:e[2];this.new_pxl_colors_length>this.best_color_number;)this.process_threshold(n,t)&&(this.deduplicate(),this.clusterize()),n+=this.new_pxl_colors_length>6e4?6:this.new_pxl_colors_length>32e3?4:this.new_pxl_colors_length>16e3?2:this.new_pxl_colors_length>8192?1.5:this.new_pxl_colors_length>4096?1:this.new_pxl_colors_length>1024?.5:.25;return this},N.split_image_data=function(e){var t,n,o=new Uint32Array(e.data.buffer),r=Uint32Array.from(new Set(o)),s={},i=r.length,a=new Uint32Array(o.length);for(t=0,n=0|i;(0|t)<(0|n);t=(t+1|0)>>>0)s[r[0|t]]=(0|t)>>>0;for(t=0,n=0|o.length;(0|t)<(0|n);t=(t+1|0)>>>0)a[0|t]=(0|s[o[0|t]])>>>0;return[a,r,o,i]};class ge{constructor(e,t,n,o){this.baseUrl=e,this.msgCallback=t||function(){},this.progressCallback=n||function(){},this.name=o||""}generateRandomSeed(){try{return crypto.getRandomValues(new Uint32Array(1))[0]}catch(e){return Math.round(4294967295*Math.random())}}message(e){try{const t=JSON.parse(e.slice(5))||{},n=t.msg;if((this.date_message||Date.now()-100)+100<=Date.now())switch(this.date_message=Date.now(),n){case"estimation":const e=t.rank_eta||0,n=(t.queue_size||0)-1,o=t.rank||0,r=`Estimated waiting duration: ${parseInt(e)} seconds. ${n>o?`Process will start after ${n} remaining job${n?"s":""}`:"Process will start immediately"}`,s=Date.now();this.progressCallback(this.name,s,s+1e3*parseInt(e)),this.msgCallback(r);break;case"progress":const i=(t.progress_data||[])[0]||{},a=`Processing: ${i.index}/${i.length} ${i.unit}.`;this.msgCallback(a);break;case"process_completed":let l="Processing completed.";const c=t.success,d=t.output||{};l=c?l:d.error,this.msgCallback(l)}}catch(t){}}generateRandomId(e=6){for(var t="";e>=6;)t+=Math.round(16777215*Math.random()).toString(16).padStart(6,"0"),e-=6;return e>0&&(t+=Math.round(16777215*Math.random()).toString(16).padStart(6,"0").slice(0,e)),t}getHeadersJson(){return{"Content-Type":"application/json"}}getHeadersStream(){return{accept:"text/event-stream"}}getHeadersAll(){return{accept:"*/*"}}getUploadUrl(e){return`${this.baseUrl}/upload?upload_id=${e}`}getCreateImagePathUrl(e){return`${this.baseUrl}/file=${e}`}async handleLoadComplete(e,t,n,o){t=void 0===t?"blob":t;let r=(e||"/unknown.webp").split("/"),s=r[r.length-1]||"unknown.png",i=s.split(".")[1]||"png",a="image/"+i;i="jpeg"===i?"jpg":i;try{const r=await new Promise((function(r){const s=new Image;s.setAttribute("crossorigin","anonymous"),s.onload=()=>{const e=s.naturalHeight||s.height,i=s.naturalWidth||s.width;o=o||e,n=n||i;try{switch(t.toLowerCase()){case"base64":!function(){const e=document.createElement("canvas");e.width=n,e.height=o,e.getContext("2d").drawImage(s,0,0,n,o);try{r(e.toDataURL("image/webp",.75))}catch(t){r(e.toDataURL("image/jpeg",.75))}}();break;case"blob":!function(){const e=document.createElement("canvas");e.width=n,e.height=o,e.getContext("2d").drawImage(s,0,0,n,o);try{e.toBlob(r,"image/webp",.75)}catch(t){e.toBlob(r,"image/jpeg",.75)}}();break;case"imagedata":!function(){const e=document.createElement("canvas");e.width=n,e.height=o;const t=e.getContext("2d");t.drawImage(s,0,0,n,o),r(t.getImageData(0,0,n,o,{colorSpace:"srgb"}))}()}}catch(a){}},s.setAttribute("src",e)}));switch(t){case"blob":const e=new File([r],s,{type:a});return Promise.resolve(e);case"base64":case"imagedata":return Promise.resolve(r)}}catch(l){return console.error("Error creating file from URL:",l),Promise.reject()}}async uploadFile(e,t){const n=new FormData;n.append("files",e);const o=await fetch(this.getUploadUrl(t),{method:"POST",body:n}),r=await o.json();return Promise.resolve(r[0]||r)}async fetchEventSource(e){const t=await fetch(e,{headers:this.getHeadersAll(),method:"GET"});return Promise.resolve(t.body.getReader())}async fetchEventSourceJSON(e){const t=await fetch(e,{headers:this.getHeadersJson(),method:"GET"}),n=(await t.clone().text()).replaceAll("event: complete\ndata: ","");try{return Promise.resolve(JSON.parse(n))}catch(o){return Promise.reject()}}async readResponse(e){const t=new TextDecoder("utf-8");let n="",o="",r=!1;for(;!r;){const{value:s,done:i}=await e.read();r=r||i,n+="".concat(t.decode(s||new Uint8Array,{stream:!0}));let a=(n||"\n").split("\n");for(let e=0;e<a.length;e++){const t=a[e].trim();if(this.message(t),t.includes("complete")&&t.includes('success":true')&&!t.includes("You have exceeded your GPU quota")&&!t.includes("custom_lora_card")&&!t.includes('data":[]'))return r=!0,o=t,Promise.resolve(o)}n=a[a.length-1]}return Promise.reject("You have exceeded your GPU quota.")}}class xe extends ge{constructor(e,t){super("https://gokaygokay-sd3-long-captioner-v2.hf.space",e,t,"captioner")}getCreateCaptionsUrl(){return this.baseUrl+"/call/create_captions_rich"}getReadCaptions(e){try{return JSON.parse(e.slice(5))}catch(t){return""}}async createCaptions(e){const t=await fetch(this.getCreateCaptionsUrl(),{method:"POST",headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:e}]})});try{const e=await t.json();return Promise.resolve(e.event_id)}catch(n){return Promise.reject("Error")}}async run(e){let t;if("string"==typeof e)t=await this.handleLoadComplete(e);else{if(!(e instanceof Blob))return Promise.reject();t=e}const n=this.generateRandomId(),o=await this.uploadFile(t,n),r=this.getCreateCaptionsUrl(),s=await this.createCaptions(o);return this.fetchEventSourceJSON(`${r}/${s}`).then((function(e){return e[0]})).catch((function(){return""}))}}class ye extends ge{constructor(e,t){super("https://gokaygokay-florence-2.hf.space",e,t,"captioner")}getPredictHeader(e,t,n,o,r,s){return s=s||1,{headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:e,url:t,orig_name:"image."+o.replaceAll("image/",""),size:n,mime_type:o,meta:{_type:"gradio.FileData"}},1===s?"Caption":2===s?"Detailed Caption":"More Detailed Caption","","microsoft/Florence-2-large"],event_data:null,fn_index:4,trigger_id:10,session_hash:r}),method:"POST"}}getQueueJoinUrl(){return this.baseUrl+"/queue/join"}getResultUrl(e){return`${this.baseUrl}/queue/data?session_hash=${e}`}readLine(e,t){console.log(e),e=e.slice(5);try{const n=JSON.parse(e);if(n.success){const e=((n.output||{}).data||[])[0],o=1===t?e.slice(15,e.length-2):2===t?e.slice(24,e.length-2):e.slice(29,e.length-2);return Promise.resolve(o.replaceAll("\\n","").replaceAll("\n",""))}return Promise.reject()}catch(n){return Promise.reject()}}async run(e,t){let n;if("string"==typeof e)n=await this.handleLoadComplete(e);else{if(!(e instanceof Blob))return Promise.reject();n=e}const o=this.generateRandomId(),r=await this.uploadFile(n,o),s=this.getCreateImagePathUrl(r),i=this.getPredictHeader(r,s,n.size,n.type,o,t),a=await fetch(this.getQueueJoinUrl(),i);if((await a.json()).event_id){const e=await this.fetchEventSource(this.getResultUrl(o));return this.readResponse(e).then((e=>this.readLine(e,t)))}return Promise.reject()}}const be={lucasArt:{url:"https://civitai.com/models/247890/lucasarts-adventure-game-style-xl",weight:1.25,face:.95,image:.125,scale:6.5,strength:.8,prompt:"In lucasarts style: a beautiful illustration of ('${prompt}':0.75) (in lucasarts style). Artwork, detailed digital painting, bold-edge, sexy character, 2D, illustration, palette-based, natural color. lucasarts style.",negative:"Photography, bad quality, ugly, text, bad, bad picture, text, error, ugly, extra fingers, extra toes, mutated hands, mutation, deformed, bad anatomy, bad proportions, extra limbs, disfigured, missing arms, missing legs, extra arms, extra legs, fused fingers, fused toes, too many fingers, too many toes, username, watermark, signature."},lucasArt2:{url:"https://civitai.com/models/151539/lucasarts-style-1990s-pc-adventure-games-sdxl-lora-dreambooth-trained",weight:1.2,face:.97,image:.12,scale:5,strength:.8,prompt:"An 2D beautiful illustration of ('${prompt}':0.618) in lcas artstyle. Artwork, detailed digital painting, bold-edge, sexy character, 2D, illustration, palette-based, natural color. lcas artstyle.",negative:"Photography, bad quality, ugly, text, bad, bad picture, text, error, ugly, extra fingers, extra toes, mutated hands, mutation, deformed, blurry, dehydrated, bad anatomy, bad proportions, extra limbs, disfigured, missing arms, missing legs, extra arms, extra legs, fused fingers, fused toes, too many fingers, too many toes, username, watermark, signature."},thimbled:{url:"https://civitai.com/models/174301/pixelartthimbledweed",weight:1.2,face:.95,image:.15,scale:9,strength:.8,prompt:"An high resolution illustration of '${prompt}' in lucasarts style with clean and bold edges. Truthful and beautifully aligned face, very high quality.",negative:"Realistic, photography, real."},arsMJ:{url:"https://civitai.com/models/547343/pixel-art-pony-sdxl",weight:.8,face:.95,image:.2,scale:9,strength:.8,prompt:"An high resolution illustration of '${prompt}' in lucasarts style with clean and bold edges. Truthful and beautifully aligned face, very high quality.",negative:"Realistic, photography, real."}};class we extends ge{constructor(e,t,n="777"){super("https://primerz-face-to-all-"+n+".hf.space",e,t,"Transform"),this.styles=be}getPredictUrl(){return this.baseUrl+"/run/predict"}getPredictHeader(e,t){return{headers:this.getHeadersJson(),body:JSON.stringify({data:[e],event_data:null,fn_index:0,trigger_id:11,session_hash:t}),method:"POST"}}getQueueJoinUrl(){return this.baseUrl+"/queue/join?__theme=light"}extractSecondImageUrl(e){const t=e.match(/"url":"(https:\/\/[^"]+)"/g);return t&&t.length>1?t[1].match(/"url":"(https:\/\/[^"]+)"/)[1]:null}getQueueJoinHeader(e,t,n,o,r,s,i){const a=this.styles[s],l=a.prompt.replace("${prompt}",r.replaceAll("\\n","").replaceAll("\\",""));return{headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:e,url:t,orig_name:"image."+o.replaceAll("image/",""),size:n,mime_type:o,meta:{_type:"gradio.FileData"}},l,a.negative,a.face,null,a.weight,a.image,a.scale,a.strength,null,null],event_data:null,fn_index:6,trigger_id:18,session_hash:i}),method:"POST"}}getQueueDataUrl(e){return`${this.baseUrl}/queue/data?session_hash=${e}`}async readResponse(e){const t=new TextDecoder("utf-8");let n="",o="",r=!1;for(;!r;){const{value:s,done:i}=await e.read();r=r||i,n+="".concat(t.decode(s||new Uint8Array,{stream:!0}));let a=(n||"\n").split("\n");for(let e=0;e<a.length;e++){const t=a[e].trim();if(this.message(t),t.includes("complete")&&t.includes('success":true')&&!t.includes("You have exceeded your GPU quota")&&!t.includes("custom_lora_card")&&!t.includes('data":[]'))return r=!0,o=t,Promise.resolve(o)}n=a[a.length-1]}return Promise.reject("You have exceeded your GPU quota.")}async run(e,t,n="lucasArt"){let o;if("string"==typeof e)o=await this.handleLoadComplete(e);else{if(!(e instanceof Blob))return Promise.reject();o=e}const r=this.generateRandomId(),s=this.generateRandomId(),i=this.getPredictHeader(this.styles[n].url,s),a=this.getPredictUrl(),l=(await fetch(a,i)).ok,c=await this.uploadFile(o,r),d=this.getCreateImagePathUrl(c);if(l&&d){const e=this.getQueueJoinHeader(c,d,o.size,o.type,t,n,s),r=this.getQueueJoinUrl(),i=await fetch(r,e);if(void 0!==(await i.json()).event_id){const e=this.getQueueDataUrl(s),t=await this.fetchEventSource(e);return this.readResponse(t).then((async e=>{const t=this.extractSecondImageUrl(e),n=await this.handleLoadComplete(t);return Promise.resolve(n)}))}}return Promise.reject()}}class Ae extends ge{constructor(e,t,n="777"){super("https://primerz-face-to-all-"+n+".hf.space",e,t,"Transform"),this.styles=be}getPredictUrl(){return this.baseUrl+"/queue/join"}getPredictHeader(e,t){return{headers:this.getHeadersJson(),body:JSON.stringify({data:[e],event_data:null,fn_index:0,trigger_id:11,session_hash:t}),method:"POST"}}extractSecondImageUrl(e){const t=e.match(/"url":"(https:\/\/[^"]+)"/g);return t&&t.length>1?t[1].match(/"url":"(https:\/\/[^"]+)"/)[1]:null}getQueueJoinHeader(e,t,n,o,r,s,i){const a=this.styles[s],l=a.prompt.replace("${prompt}",r.replaceAll("\\n","").replaceAll("\\",""));return{headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:e,url:t,orig_name:"image."+o.replaceAll("image/",""),size:n,mime_type:o,meta:{_type:"gradio.FileData"}},l,a.negative,a.face,null,a.weight,a.image,a.scale,a.strength,null,null],event_data:null,fn_index:6,trigger_id:18,session_hash:i}),method:"POST"}}async readResponse(e){const t=new TextDecoder("utf-8");let n="",o="",r=!1;for(;!r;){const{value:s,done:i}=await e.read();r=r||i,n+="".concat(t.decode(s||new Uint8Array,{stream:!0}));let a=(n||"\n").split("\n");for(let e=0;e<a.length;e++){const t=a[e].trim();if(this.message(t),t.includes("complete")&&t.includes('success":true')&&!t.includes("You have exceeded your GPU quota")&&!t.includes("custom_lora_card")&&!t.includes('data":[]'))return r=!0,o=t,Promise.resolve(o)}n=a[a.length-1]}return Promise.reject("You have exceeded your GPU quota.")}async run(e,t,n="lucasArt"){let o;if("string"==typeof e)o=await this.handleLoadComplete(e);else{if(!(e instanceof Blob))return Promise.reject();o=e}const r=this.generateRandomId(8),s=this.generateRandomId(11),i=this.getPredictHeader(this.styles[n].url,s),a=this.getPredictUrl(),l=(await fetch(a,i)).ok,c=await this.uploadFile(o,r),d=this.getCreateImagePathUrl(c);if(l&&d){const e=this.getQueueJoinHeader(c,d,o.size,o.type,t,n,s),r=this.getQueueJoinUrl(),i=await fetch(r,e);if(i.ok&&void 0!==(await i.json()).event_id){const e=this.getQueueDataUrl(s),t=await fetch(e,this.getUselessBullshit(s));if(t.ok&&(await t.json()).event_id){const t=await this.fetchEventSource(e);return this.readResponse(t).then((async e=>{const t=this.extractSecondImageUrl(e),n=await this.handleLoadComplete(t);return Promise.resolve(n)}))}}}return Promise.reject()}}class ve extends ge{constructor(e,t,n="777"){super("https://primerz-face-to-all-"+n+".hf.space",e,t,"Transform"),this.styles=be}getPredictUrl(){return this.baseUrl+"/run/predict"}getPredictHeader(e,t){return{headers:this.getHeadersJson(),body:JSON.stringify({data:[e],event_data:null,fn_index:0,trigger_id:11,session_hash:t}),method:"POST"}}extractSecondImageUrl(e){const t=e.match(/"url":"(https:\/\/[^"]+)"/g);return t&&t.length>1?t[1].match(/"url":"(https:\/\/[^"]+)"/)[1]:null}getQueueJoinHeader(e,t,n,o,r,s,i){const a=this.styles[s],l=a.prompt.replace("${prompt}",r.replaceAll("\\n","").replaceAll("\\",""));return{headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:e,url:t,orig_name:"image."+o.replaceAll("image/",""),size:n,mime_type:o,meta:{_type:"gradio.FileData"}},l,a.negative,a.face,null,a.weight,a.image,a.scale,a.strength,null,null],event_data:null,fn_index:6,trigger_id:18,session_hash:i}),method:"POST"}}async readResponse(e){const t=new TextDecoder("utf-8");let n="",o="",r=!1;for(;!r;){const{value:s,done:i}=await e.read();r=r||i,n+="".concat(t.decode(s||new Uint8Array,{stream:!0}));let a=(n||"\n").split("\n");for(let e=0;e<a.length;e++){const t=a[e].trim();if(this.message(t),t.includes("complete")&&t.includes('success":true')&&!t.includes("You have exceeded your GPU quota")&&!t.includes("custom_lora_card")&&!t.includes('data":[]'))return r=!0,o=t,Promise.resolve(o)}n=a[a.length-1]}return Promise.reject("You have exceeded your GPU quota.")}async run(e,t,n="lucasArt"){let o;if("string"==typeof e)o=await this.handleLoadComplete(e);else{if(!(e instanceof Blob))return Promise.reject();o=e}const r=this.generateRandomId(),s=this.generateRandomId(),i=this.getPredictHeader(this.styles[n].url,s),a=this.getPredictUrl(),l=await fetch(a,i),c=await l.json(),d=await this.uploadFile(o,r),h=this.getCreateImagePathUrl(d);if(c&&h){const e=this.getQueueJoinHeader(d,h,o.size,o.type,t,n,s),r=this.getQueueJoinUrl(),i=await fetch(r,e);if(void 0!==(await i.json()).event_id){const e=this.getQueueDataUrl(s),t=await this.fetchEventSource(e);return this.readResponse(t).then((async e=>{const t=this.extractSecondImageUrl(e),n=await this.handleLoadComplete(t);return Promise.resolve(n)}))}}return Promise.reject()}}O=n(5556),W=n.n(O),F=n(7160),q=n(88016),V=n(1128),H=n(33615),G=n(95652),X=n(32485),$=n.n(X);const Se={standard:y.A,filled:F.Ay,outlined:q.A};class Ce extends i.default.Component{state={chips:[],errorText:void 0,focusedChip:null,inputValue:"",isClean:!0,isFocused:!1,chipsUpdated:!1,prevPropsValue:[]};constructor(e){super(e),e.defaultValue&&(this.state.chips=e.defaultValue),this.labelRef=i.default.createRef(),this.input=i.default.createRef()}componentDidMount(){"outlined"===this.props.variant&&(this.labelNode=i.default.findDOMNode(this.labelRef.current),this.forceUpdate())}componentWillUnmount(){clearTimeout(this.inputBlurTimeout)}static getDerivedStateFromProps(e,t){let n=null;return e.value&&e.value.length!==t.prevPropsValue.length&&(n={prevPropsValue:e.value},e.clearInputValueOnChange&&(n.inputValue="")),e.clearInputValueOnChange&&e.value&&e.value.length!==t.prevPropsValue.length&&(n={prevPropsValue:e.value,inputValue:""}),e.disabled&&(n={...n,focusedChip:null}),!t.chipsUpdated&&e.defaultValue&&(n={...n,chips:e.defaultValue}),n}blur(){this.input&&this.actualInput.blur()}focus=()=>{this.actualInput.focus(),null!=this.state.focusedChip&&this.setState({focusedChip:null})};handleInputBlur=e=>{this.props.onBlur&&this.props.onBlur(e),this.setState({isFocused:!1}),null!=this.state.focusedChip&&this.setState({focusedChip:null});const t=e.target.value;let n;switch(this.props.blurBehavior){case"add-or-clear":n={clearInputOnFail:!0};case"add":if(this.props.delayBeforeAdd){const e=(this.props.value||this.state.chips).length;this.inputBlurTimeout=setTimeout((()=>{const o=(this.props.value||this.state.chips).length;e===o?this.handleAddChip(t,n):this.clearInput()}),150)}else this.handleAddChip(t,n);break;case"clear":this.clearInput()}};handleInputFocus=e=>{this.setState({isFocused:!0}),this.props.onFocus&&this.props.onFocus(e)};handleKeyDown=e=>{const{focusedChip:t}=this.state;if(this._keyPressed=!1,this._preventChipCreation=!1,this.props.onKeyDown&&(this.props.onKeyDown(e),e.isDefaultPrevented()))return;const n=this.props.value||this.state.chips;if(this.props.newChipKeyCodes.indexOf(e.keyCode)>=0||this.props.newChipKeys.indexOf(e.key)>=0)!1!==this.handleAddChip(e.target.value)&&e.preventDefault();else switch(e.keyCode){case 8:""===e.target.value&&(null!=t?(this.handleDeleteChip(n[t],t),t>0&&this.setState({focusedChip:t-1})):this.setState({focusedChip:n.length-1}));break;case 46:""===e.target.value&&null!=t&&(this.handleDeleteChip(n[t],t),t<=n.length-1&&this.setState({focusedChip:t}));break;case 37:null==t&&""===e.target.value&&n.length?this.setState({focusedChip:n.length-1}):null!=t&&t>0&&this.setState({focusedChip:t-1});break;case 39:null!=t&&t<n.length-1?this.setState({focusedChip:t+1}):this.setState({focusedChip:null});break;default:this.setState({focusedChip:null})}};handleKeyUp=e=>{!this._preventChipCreation&&(this.props.newChipKeyCodes.indexOf(e.keyCode)>=0||this.props.newChipKeys.indexOf(e.key)>=0)&&this._keyPressed?this.clearInput():this.updateInput(e.target.value),this.props.onKeyUp&&this.props.onKeyUp(e)};handleKeyPress=e=>{this._keyPressed=!0,this.props.onKeyPress&&this.props.onKeyPress(e)};handleUpdateInput=e=>{null==this.props.inputValue&&this.updateInput(e.target.value),this.props.onUpdateInput&&this.props.onUpdateInput(e)};handleAddChip(e,t){if(this.props.onBeforeAdd&&!this.props.onBeforeAdd(e))return this._preventChipCreation=!0,null!=t&&t.clearInputOnFail&&this.clearInput(),!1;this.clearInput();const n=this.props.value||this.state.chips;return this.props.dataSourceConfig?("string"==typeof e&&(e={[this.props.dataSourceConfig.text]:e,[this.props.dataSourceConfig.value]:e}),!this.props.allowDuplicates&&n.some((t=>t[this.props.dataSourceConfig.value]===e[this.props.dataSourceConfig.value]))||(this.props.value&&this.props.onAdd?this.props.onAdd(e):this.updateChips([...this.state.chips,e])),!0):e.trim().length>0&&((this.props.allowDuplicates||-1===n.indexOf(e))&&(this.props.value&&this.props.onAdd?this.props.onAdd(e):this.updateChips([...this.state.chips,e])),!0)}handleDeleteChip(e,t){if(this.props.value)this.props.onDelete&&this.props.onDelete(e,t);else{const e=this.state.chips.slice();if(e.splice(t,1)){let n=this.state.focusedChip;this.state.focusedChip===t?n=null:this.state.focusedChip>t&&(n=this.state.focusedChip-1),this.updateChips(e,{focusedChip:n})}}}updateChips(e,t={}){this.setState({chips:e,chipsUpdated:!0,...t}),this.props.onChange&&this.props.onChange(e)}clearInput(){this.updateInput("")}updateInput(e){this.setState({inputValue:e})}setActualInputRef=e=>{this.actualInput=e,this.props.inputRef&&this.props.inputRef(e)};render(){const{allowDuplicates:e,alwaysShowPlaceholder:t,blurBehavior:n,children:o,chipRenderer:r=Re,classes:a,className:l,clearInputValueOnChange:c,dataSource:d,dataSourceConfig:h,defaultValue:u,delayBeforeAdd:_,disabled:p,disableUnderline:f,error:m,filter:g,FormHelperTextProps:x,fullWidth:y,fullWidthInput:b,helperText:w,id:A,InputProps:v={},inputRef:C,InputLabelProps:E={},inputValue:R,label:B,newChipKeyCodes:k,newChipKeys:D,onBeforeAdd:P,onAdd:L,onBlur:I,onDelete:U,onChange:T,onFocus:z,onKeyDown:M,onKeyPress:j,onKeyUp:N,onUpdateInput:O,placeholder:W,readOnly:F,required:q,rootRef:H,value:X,variant:J,...Y}=this.props,K=X||this.state.chips,Q=null!=R?R:this.state.inputValue,Z=(this.props.value||Q).length>0||Q.length>0,ee=null!=E.shrink?E.shrink:null!=B&&(Z||this.state.isFocused||K.length>0),te=K.map(((e,t)=>{const n=h?e[h.value]:e;return r({value:n,text:h?e[h.text]:e,chip:e,isDisabled:!!p,isReadOnly:F,isFocused:this.state.focusedChip===t,handleClick:()=>this.setState({focusedChip:t}),handleDelete:()=>this.handleDeleteChip(e,t),className:a.chip},t)})),ne={};"outlined"===J&&(ne.notched=ee,ne.labelWidth=ee&&this.labelNode&&this.labelNode.offsetWidth||0),"standard"!==J?ne.startAdornment=i.default.createElement(i.default.Fragment,null,te):v.disableUnderline=!0;const oe=Se[J];return i.default.createElement(S.A,s({ref:H,fullWidth:y,className:$()(l,a.root,{[a.marginDense]:"dense"===Y.margin}),error:m,required:K.length>0?void 0:q,onClick:this.focus,disabled:p,variant:J},Y),B&&i.default.createElement(V.A,s({htmlFor:A,classes:{root:$()(a[J],a.label),shrink:a.labelShrink},shrink:ee,focused:this.state.isFocused,variant:J,ref:this.labelRef,required:q},E),B),i.default.createElement("div",{className:$()(a[J],a.chipContainer,{[a.focused]:this.state.isFocused,[a.underline]:!f&&"standard"===J,[a.disabled]:p,[a.labeled]:null!=B,[a.error]:m})},"standard"===J&&te,i.default.createElement(oe,s({ref:this.input,classes:{input:$()(a.input,a[J]),root:$()(a.inputRoot,a[J])},id:A,value:Q,onChange:this.handleUpdateInput,onKeyDown:this.handleKeyDown,onKeyPress:this.handleKeyPress,onKeyUp:this.handleKeyUp,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,inputRef:this.setActualInputRef,disabled:p,fullWidth:b,placeholder:!Z&&(ee||null==B)||t?W:null,readOnly:F},v,ne))),w&&i.default.createElement(G.A,s({},x,{className:x?$()(x.className,a.helperText):a.helperText}),w))}}Ce.propTypes={allowDuplicates:W().bool,alwaysShowPlaceholder:W().bool,blurBehavior:W().oneOf(["clear","add","add-or-clear","ignore"]),chipRenderer:W().func,clearInputValueOnChange:W().bool,dataSource:W().array,dataSourceConfig:W().shape({text:W().string.isRequired,value:W().string.isRequired}),defaultValue:W().array,delayBeforeAdd:W().bool,disabled:W().bool,disableUnderline:W().bool,FormHelperTextProps:W().object,fullWidth:W().bool,fullWidthInput:W().bool,helperText:W().node,InputLabelProps:W().object,InputProps:W().object,inputRef:W().func,inputValue:W().string,label:W().node,newChipKeyCodes:W().arrayOf(W().number),newChipKeys:W().arrayOf(W().string),onAdd:W().func,onBeforeAdd:W().func,onChange:W().func,onDelete:W().func,onUpdateInput:W().func,placeholder:W().string,readOnly:W().bool,value:W().array,variant:W().oneOf(["outlined","standard","filled"])},Ce.defaultProps={allowDuplicates:!1,blurBehavior:"clear",clearInputValueOnChange:!1,delayBeforeAdd:!1,disableUnderline:!1,newChipKeyCodes:[13],newChipKeys:["Enter"],variant:"standard"};const Ee=(0,l.default)((e=>{const t="light"===e.palette.type,n=t?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return{root:{},inputRoot:{display:"inline-flex",flexWrap:"wrap",flex:1,marginTop:0,minWidth:70,"&$outlined,&$filled":{boxSizing:"border-box"},"&$outlined":{paddingTop:14},"&$filled":{paddingTop:28}},input:{display:"inline-block",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",appearance:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",float:"left",flex:1},chipContainer:{display:"flex",flexFlow:"row wrap",cursor:"text",marginBottom:-2,minHeight:40,"&$labeled&$standard":{marginTop:18}},outlined:{"& input":{height:16,paddingTop:4,paddingBottom:12,marginTop:4,marginBottom:4}},standard:{},filled:{"& input":{height:22,marginBottom:4,marginTop:4,paddingTop:0},"$marginDense & input":{height:26}},labeled:{},label:{top:4,"&$outlined&:not($labelShrink)":{top:2,"$marginDense &":{top:5}},"&$filled&:not($labelShrink)":{top:15,"$marginDense &":{top:20}}},labelShrink:{top:0},helperText:{marginBottom:-20},focused:{},disabled:{},underline:{"&:after":{borderBottom:"2px solid "+e.palette.primary[t?"dark":"light"],left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},"&$focused:after":{transform:"scaleX(1)"},"&$error:after":{borderBottomColor:e.palette.error.main,transform:"scaleX(1)"},"&:before":{borderBottom:"1px solid "+n,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},"&:hover:not($disabled):not($focused):not($error):before":{borderBottom:"2px solid "+e.palette.text.primary,"@media (hover: none)":{borderBottom:"1px solid "+n}},"&$disabled:before":{borderBottomStyle:"dotted"}},error:{"&:after":{backgroundColor:e.palette.error.main,transform:"scaleX(1)"}},chip:{margin:"0 8px 8px 0",float:"left"},marginDense:{}}}),{name:"WAMuiChipInput"})(Ce),Re=({value:e,text:t,isFocused:n,isDisabled:o,isReadOnly:r,handleClick:s,handleDelete:a,className:l},c)=>i.default.createElement(H.A,{key:c,className:l,style:{pointerEvents:o||r?"none":void 0,backgroundColor:n?"rgb(96, 96, 96)":void 0},onClick:s,onDelete:a,label:t});class Be extends i.default.Component{constructor(e){super(e),this.state={classes:e.classes,keepMounted:e.keepMounted||!1,open:e.open,_drop_ref:null,_preferred_size:"M",_title:"",_currentStep:0,_totalStep:3,_drag_file:{},_preview:{},_preview_kb:0,_previews:[],_canvas:{},_offscreen_canvas:{},_base64:"",_dropzone_active:!1,_tags:[],_message:"We maintains privacy and doesn't store uploaded images.",_close_confirm_close_open:!1,process:{name:"upload file",start:0,finish:0}}}componentWillReceiveProps(e){this.setState(e,(()=>{this.forceUpdate()}))}_resetProps=()=>{this.setState({_drop_ref:null,_preferred_size:"M",_title:"",_currentStep:0,_totalStep:3,_drag_file:{},_preview:{},_preview_kb:0,_previews:[],_canvas:{},_offscreen_canvas:{},_base64:"",_dropzone_active:!1,_message:"We maintains privacy and doesn't store uploaded images.",_close_confirm_close_open:!1,process:{name:"upload file",start:0,finish:0}},this.forceUpdate)};_setTags=e=>{this.setState({_tags:e.target.value.toString()},this.forceUpdate)};_drop_start=e=>{e.preventDefault(),e.stopPropagation();const t=this.state._dropzone_active;this.setState({_dropzone_active:!0},(()=>{t||this.forceUpdate()}))};_drop_end=e=>{e.preventDefault(),e.stopPropagation();const t=this.state._dropzone_active;this.setState({_dropzone_active:!1},(()=>{t&&this.forceUpdate()}))};_trigger_message=e=>{this.setState({_message:e},this.forceUpdate)};_handle_file_upload=async e=>{"dataTransfer"in e&&e.dataTransfer.files.length>0&&(e.preventDefault(),e.stopPropagation());const t=(e.target||{}).files||(e.srcElement||{}).files||(e.currentTarget||{}).files||((e.path||[])[0]||{}).files||(e.dataTransfer||{}).files||[],n=t[0]||null;let s=null;for(let o=0;o<t.length;o++)s=t[o],s.type.startsWith("image/")&&(o=t.length);if(null===s&&null===n)this._trigger_message("Looks like I can't get your file as something is erroneous.",5700);else if(null!==s){"image/png"===s.type||s.type;const e=await async function(e){const t=await createImageBitmap(e),n=o(t.width,t.height,262144),s=r(t.width,t.height),i=s.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(t,0,0,t.width,t.height),t.close();const a=i.getImageData(0,0,s.width,s.height),l=new Uint32Array(a.data.buffer),c=Uint32Array.from(new Set(l));return n<=1&&c.length<128&&a}(s);if(e instanceof ImageData)this._trigger_message("The image appears to be already optimized!"),this.setState({_previews:[{name:"default",imageData:e}],_title:"",_currentStep:1,process:{name:"upload file",start:0,finish:0}},(()=>{this.forceUpdate((()=>{this._set_size()}))}));else{const e=await async function(e,t,n,s,i,a){const l=await(async(e,t=()=>{},n=()=>{})=>{const o=new ye(t,n),r=new xe(t,n);return await o.run(e,1).catch((()=>r.run(e).catch((()=>Promise.resolve("a person")))))||""})(e,i,a);e=await(async(e,t="",n=()=>{},o=()=>{})=>{const r=new we(n,o),s=new Ae(n,o),i=new ve(n,o),a=new we(n,o,"666"),l=new Ae(n,o,"666"),c=new ve(n,o,"666");return r.run(e,t,"lucasArt").then((e=>Promise.resolve(e))).catch((()=>s.run(e,t,"lucasArt").then((e=>Promise.resolve(e))).catch((()=>i.run(e,t,"lucasArt").then((e=>Promise.resolve(e))).catch((()=>a.run(e,t,"lucasArt").then((e=>Promise.resolve(e))).catch((()=>l.run(e,t,"lucasArt").then((e=>Promise.resolve(e))).catch((()=>c.run(e,t,"lucasArt").then((e=>Promise.resolve(e))).catch((()=>Promise.resolve(e)))))))))))))})(e,l,i,a);const c=await createImageBitmap(e,{resizeQuality:"pixelated"}),d=o(c.width,c.height,1048576),h=Math.round(c.width*d),u=Math.round(c.height*d),_=r(h,u),p=_.getContext("2d");p.imageSmoothingEnabled=!1,p.drawImage(c,0,0,h,u),c.close();const f=r(1,1),m=f.getContext("2d");return m.imageSmoothingEnabled=!1,{artworks:[{name:"XS",size:64,colors:16},{name:"S",size:96,colors:24},{name:"M",size:128,colors:32},{name:"L",size:192,colors:48},{name:"XL",size:256,colors:64},{name:"XXL",size:384,colors:96}].map((function(e){return e.imageData=function(e){function t(e,t){return i[t*o+e|0]}function n(e,t,n){i[t*o+e|0]=n>>>0}const{width:o,height:r,data:s}=e,i=new Uint32Array(s.buffer);let a=0,l={},c=new Uint32Array(8),d=0;for(let _=1;_<r-1;_=_+1|0)for(let e=1;e<o-1;e=e+1|0){l={},a=t(e,_),c[0]=t(e-1,_-1),c[1]=t(e,_-1),c[2]=t(e+1,_-1),c[3]=t(e-1,_),c[4]=t(e+1,_),c[5]=t(e-1,_+1),c[0]=t(e,_+1),c[7]=t(e+1,_+1);for(var h=0;h<8;h++)d=c[h],l[d]=(l[d]||0)+1,l[d]>=6&&n(e,_,d)}const u=new Uint8ClampedArray(i.buffer);return new ImageData(u,o,r)}(function(e,t){const n=o(t.width,t.height,e.size*e.size);return f.width=Math.round(t.width*n),f.height=Math.round(t.height*n),m.drawImage(t,0,0,0|t.width,0|t.height,0,0,0|f.width,0|f.height),function(e,t){const n=function(e,t){var n,o,r,s,i,a,l,c,d;const[h,u,_,p]=N.split_image_data(e);if(Date.now(),n="auto"===t,o=parseFloat(t)>0&&parseFloat(t)<1,r=parseInt(t)<0,"auto"===(s=n?"auto":o||r?r?Math.max(1,p+parseInt(t)):o?Math.max(1,parseFloat(t)*p):p:parseInt(t))&&(s=p>255?255:p/2|0),s>=p)return e;for(i=new N({pxls:h,pxl_colors:u,speed:"auto",number_of_color:Math.min(p,s),width:e.width,height:e.height}).init().run().output("split"),Date.now(),l=0|(a=i[0]).length,c=i[1],d=0;(0|d)<(0|l);d=(d+1|0)>>>0)_[0|d]=(0|c[(0|a[0|d])>>>0])>>>0;return new ImageData(new Uint8ClampedArray(_.buffer),e.width,e.height)}(e.getImageData(0,0,e.canvas.width,e.canvas.height),t);e.putImageData(n,0,0)}(m,e.colors),m.getImageData(0,0,0|f.width,0|f.height)}(e,_)),e})),prompt:l||""}}(s,0,0,0,this._trigger_message,this._set_process);this.setState({_previews:e.artworks,_title:e.prompt,_currentStep:1,process:{name:"upload file",start:0,finish:0}},(()=>{this.forceUpdate((()=>{this._set_size()}))}))}}};_setTitle=e=>{this.setState({_title:e.target.value},this.forceUpdate)};_set_process=(e,t,n)=>{const o=setInterval(this.forceUpdate.bind(this),250),r=setTimeout((()=>{this.state.process._interval===o&&clearInterval(this.state.process._interval)}),n-t);this.setState({process:{name:e,start:t,finish:n,_interval:o,_timout:r}},(()=>{this.forceUpdate()}))};_handle_size_change=e=>{this.setState({_preferred_size:e.target.value},(()=>{this._set_size()}))};_set_canvas_ref=e=>{if(void 0===e)return this._set_size();if(null==e)return this._set_size();if(void 0===e.width)return this._set_size();if(null==e.width)return this._set_size();if("function"==typeof e.getContext){var t=e;t.context=e.getContext("2d"),this.setState({_canvas:t},(()=>{this._set_size()}))}};_set_size=()=>{this.state._previews.forEach((e=>{1!==this.state._previews.length&&e.name.toUpperCase()!==this.state._preferred_size.toUpperCase()||this.setState({_preview:e.imageData},(()=>{this.state._canvas.width=this.state._preview.width,this.state._canvas.height=this.state._preview.height,this.state._canvas.context.putImageData(this.state._preview,0,0),(0,d.A)((()=>n.e("src_js_utils_encodeImage_js").then(n.bind(n,38420)))).then((({encodeIMG:e})=>{e(this.state._preview).then((e=>{this.setState({_base64:e},this.forceUpdate)}))}))}))}))};download_artwork=()=>{let e=document.createElement("a");e.download="Pixagram.webp",e.href=this.state._base64,e.click(),e.remove()};_set_drop_ref=e=>{null!=e&&this.setState({_drop_ref:e},(()=>{this.state._drop_ref.addEventListener("drop",this._handle_file_upload.bind(this)),this.state._drop_ref.addEventListener("dragenter",this._drop_start.bind(this)),this.state._drop_ref.addEventListener("dragover",this._drop_start.bind(this)),this.state._drop_ref.addEventListener("dragleave",this._drop_end.bind(this)),this.state._drop_ref.addEventListener("dragend",this._drop_end.bind(this))}))};_backOrCancel=e=>{parseInt(this.state._currentStep)<=1?e?this.close_confirm():this.setState({_close_confirm_close_open:!0},this.forceUpdate):this.setState({_currentStep:parseInt(this.state._currentStep)-1},this.forceUpdate)};request_close=()=>{this.setState({_close_confirm_close_open:!0},this.forceUpdate)};_nextOrFinish=()=>{2===parseInt(this.state._currentStep)?(this._resetProps(),this.props.onClose()):this.setState({_currentStep:parseInt(this.state._currentStep)+1},this.forceUpdate)};_open_link=e=>{window.open(e,"_blank")};close_confirm_close=()=>{this.setState({_close_confirm_close_open:!1},(()=>{this.forceUpdate()}))};close_confirm=()=>{this.setState({_close_confirm_close_open:!1},(()=>{this.forceUpdate((()=>{this._resetProps(),this.props.onClose()}))}))};render(){const{classes:e,_title:t,_preferred_size:n,_currentStep:o,_totalStep:r,open:s,keepMounted:a,_preview:l,_dropzone_active:c,process:d,_base64:h,_tags:u,_previews:_,_message:p,_close_confirm_close_open:f}=this.state,{name:m,start:g,finish:x}=d;let I=null,U=x-g,T=Date.now()-g,z=T/U,M=U>T,j=((h||"").length||0)/1024*3/4;switch(o.toString()){case"0":I=i.default.createElement("form",{noValidate:!0,autoComplete:"off",ref:this._set_drop_ref,style:{position:"relative"}},i.default.createElement("div",{style:{borderRadius:"12px"},className:c?e.dropZoneActive:e.dropZone},i.default.createElement(y.A,{onChange:this._handle_file_upload,accept:"image/*",style:{display:"none",position:"absolute"},id:"button-file-dialog-secondary",type:"file"}),i.default.createElement("div",{style:{transform:"translate(-50%, -50%)",top:"50%",position:"absolute",display:"inline"}},i.default.createElement(b.A,{disabled:M||"upload file"!=m,component:"label",htmlFor:"button-file-dialog-secondary",onClick:this._handle_file_upload},i.default.createElement("span",{style:{fontWeight:"bold",fontSize:"24px",verticalAlign:"super",color:"#999",marginRight:"16px"}},m||"Upload Image"),M||"upload file"!=m?i.default.createElement(w.A,{position:"relative",display:"inline-flex"},i.default.createElement(A.A,{variant:M?"determinate":"indeterminate",color:"#ffffff",value:Math.round(100*z)}),i.default.createElement(w.A,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},i.default.createElement(v.A,{variant:"caption",component:"div",color:"textSecondary"},M?Math.round(Math.min(100*z,100))+"%":"wait"))):i.default.createElement(L.A,{style:{color:"#666"}})),i.default.createElement("p",{style:{textAlign:"center",color:"#a7a7a7"}},p))));break;case"1":I=i.default.createElement("div",{noValidate:!0,autoComplete:"off",style:{position:"relative"}},i.default.createElement(S.A,{component:"fieldset",style:{padding:"8px 16px 64px 16px",position:"absolute",background:"linear-gradient(180deg, #101010cf 20%, #10101075 60%, #10101000 90%)",width:"100%",top:"0px"}},1===(_||0).length?i.default.createElement("p",null,"Your artwork is already optimized for pixel art"):i.default.createElement(C.A,{row:!0,defaultValue:"top","aria-label":"size",name:"SIZE",color:"primary",value:n,onChange:this._handle_size_change},i.default.createElement(E.A,{value:"XS",control:i.default.createElement(R.A,null),label:"XS"}),i.default.createElement(E.A,{value:"S",control:i.default.createElement(R.A,null),label:"S"}),i.default.createElement(E.A,{value:"M",control:i.default.createElement(R.A,null),label:"M"}),i.default.createElement(E.A,{value:"L",control:i.default.createElement(R.A,null),label:"L"}),i.default.createElement(E.A,{value:"XL",control:i.default.createElement(R.A,null),label:"XL"}),i.default.createElement(E.A,{value:"XXL",control:i.default.createElement(R.A,null),label:"XXL"}))),i.default.createElement("div",{className:"pixelated",style:{width:"100%"}},i.default.createElement("canvas",{style:{borderRadius:"12px",width:"100%"},ref:this._set_canvas_ref,width:l.width+"px",height:l.height+"px"})),i.default.createElement("div",{style:{padding:"64px 8px 16px 8px",textAlign:"right",position:"absolute",background:"linear-gradient(0deg, #101010cf 20%, #10101075 60%, #10101000 90%)",width:"100%",bottom:"0px"}},i.default.createElement(b.A,{variant:"text",color:"#ffffff88",onClick:this.download_artwork},"DOWNLOAD (",j.toFixed(2)," kB)"),i.default.createElement(b.A,{variant:"text",color:"#ffffff88",onClick:()=>this._open_link("https://pixa.pics/")},"OPEN EDITOR")));break;case"2":I=i.default.createElement("div",{noValidate:!0,autoComplete:"off"},i.default.createElement(B.A,{value:t,fullWidth:!0,label:"Title",variant:"outlined",onChange:this._setTitle}),i.default.createElement(B.A,{style:{marginTop:24,marginBottom:24},label:"Content",multiline:!0,rows:1,defaultValue:h,variant:"filled",disabled:!0,fullWidth:!0}),i.default.createElement(B.A,{style:{marginTop:24,marginBottom:24},label:"Description",multiline:!0,minRows:6,defaultValue:"",variant:"outlined",fullWidth:!0}),i.default.createElement(Ee,{fullWidth:!0,label:"Tags",placeholder:"Tags for content classification"}))}return i.default.createElement(i.default.Fragment,null,i.default.createElement(k.A,{open:s,maxWidth:"sm",fullWidth:!0,disablePortal:!1,onClose:this.request_close,keepMounted:a},i.default.createElement(D.A,null,i.default.createElement(v.A,{style:{marginTop:8,marginBottom:24},component:"h2",variant:"h6"},"Publisher"),I),i.default.createElement(P.A,{style:{textAlign:"right"}},i.default.createElement(b.A,{variant:"text",color:"primary",autoFocus:!0,onClick:()=>this._backOrCancel(!(M||"upload file"!=m))},parseInt(o)>0?"Back":"Cancel"),i.default.createElement(b.A,{variant:"contained",color:"primary",disabled:0===parseInt(o),onClick:this._nextOrFinish},2===parseInt(o)?"Publish":"Next"))),i.default.createElement(k.A,{open:f,maxWidth:"xs",disablePortal:!1,onClose:this.close_confirm_close,keepMounted:!1},i.default.createElement(D.A,null,i.default.createElement(v.A,{style:{marginTop:8,marginBottom:24},component:"h2",variant:"h6"},"Are you sure?"),i.default.createElement("p",null,"Your current artwork will be lost.")),i.default.createElement(P.A,{style:{textAlign:"right"}},i.default.createElement(b.A,{variant:"text",color:"primary",autoFocus:!0,onClick:this.close_confirm_close},"Cancel"),i.default.createElement(b.A,{variant:"contained",color:"primary",onClick:this.close_confirm},"Close"))))}}const ke=(0,l.default)((e=>({dropZone:{width:"100%",height:"100%",aspectRatio:"1/1",border:"2px dashed #666",textAlign:"center",verticalAlign:"middle",backgroundColor:"transparent",transition:"all 225ms cubic-bezier(0.4, 0, 0.2, 1) 225ms"},dropZoneActive:{width:"100%",height:"100%",aspectRatio:"1/1",border:"2px solid #666",textAlign:"center",verticalAlign:"middle",backgroundColor:"rgba(255, 255, 255, 0.07)",transition:"all 225ms cubic-bezier(0.4, 0, 0.2, 1) 25ms"}})))(Be);J=n(28379);class De extends h.a{_getEstimatedTotalHeight(){const{cellCount:e,cellMeasurerCache:t,width:n}=this.props,o=Math.floor(n/(t||{}).defaultWidth||0),r=this._positionCache.estimateTotalHeight(e,o,(t||{}).defaultHeight||0);return isFinite(r)?r:0}}class Pe extends i.default.PureComponent{constructor(e){super(e),this.st4te={classes:e.classes,_settings:e.settings,_history:a.Vv,_pathname:e.pathname,_image_name_infographics:"",_infographics_fadein_time:300,_infographics_in:!0,_bii3_opacity:1,_join_now_button_update:0,_less_than_960w:!0,_less_than_690h:!0,sorting:0,menuCardXY:[],menuCardData:{},authors:[],_scrolling_reset_time_interval:300,_min_col_width:10,_max_col_width:1e3,_root_width:0,_root_height:0,_root:null,_window_width:0,_window_height:0,_average_img_ratio:1,_gutter_size:16,column_count:4,_column_width:356,_load_more_threshold:2e3,_overscan_by_pixels:6e3,_cell_positioner:null,_cell_positioner_config:null,_masonry:null,_cell_measurer_cache:null,_scroll_top:0,_intervals:[],_y:0,_top_scroll_of_el_by_index:[],_height_of_el_by_index:[],_x_y_of_el_by_index:[],_selected_post_index:0,_post_closed_at:0,data:[],_create_artwork_dialog_open:!1,_artwork_open:!1,_post:{}}}componentWillMount(){window.addEventListener("resize",this._updated_dimensions),c.qf(),c.wn(0),setTimeout((()=>{c.wn(100)}),300);const e=setInterval(this._handle_masonry_scroll,125);this.setSt4te({_intervals:[e]})}setSt4te(e,t){e=e||{},this.st4te=Object.assign(this.st4te,e),"function"==typeof t&&t()}componentDidMount(){this._updated_dimensions(),i.default.findDOMNode(this).addEventListener("keydown",this._handle_keydown),(0,d.A)((()=>n.e("src_js_data_authors_js").then(n.bind(n,60209)))).then((e=>{const t=e.default();(0,d.A)((()=>n.e("src_js_data_posts_js").then(n.bind(n,65138)))).then((e=>{const n=e.default();this.setSt4te({data:n.map((e=>(e.author=t[e.author],e)))},(()=>{this.forceUpdate((()=>{this._updated_dimensions()}))}))}))}))}_updated_dimensions=()=>{let e=document.documentElement,t=document.body||document.getElementsByTagName("body")[0],n=window.innerWidth||e.clientWidth||t.clientWidth,o=window.innerHeight||e.clientHeight||t.clientHeight;const r=!!(n<960),s=!!(o<690),i=this.st4te._less_than_960w!==r||this.st4te._less_than_690h!==s;this.setSt4te({_posts:[],_window_width:n,_window_height:o,_load_more_threshold:o*(o/n)*2},(()=>{this.forceUpdate((()=>{const{_root:e,_gutter_size:t,_window_width:n,_window_height:o,data:r}=this.st4te;let{_column_count:s}=this.st4te;if(e){const i=e.getBoundingClientRect(),a=i.width,l=i.height;if(n<100||a<100||l<100||o<100)setTimeout((()=>{this._updated_dimensions()}),250);else{s=n>1920?6:n>1280?4:n>960?3:n>480?2:1;const e=Math.floor((i.width-(s+1)*t)/s);this.setSt4te({_overscan_by_pixels:o*(o/n)*8,_posts:r,_column_width:e,_column_count:s,_root_width:a,_root_height:l},(()=>{this._init_cell_measurements()}))}}else setTimeout((()=>{this._updated_dimensions()}),150)}))})),i&&this.setSt4te({_less_than_960w:r,_less_than_690h:s,_window_width:n,_window_height:o},(()=>{this.forceUpdate()}))};componentWillReceiveProps(e){const t=e.settings._renderer!==this.st4te._settings._renderer,n=e.settings._nsfw_enabled!==this.st4te._settings._nsfw_enabled;this.setSt4te({_settings:e.settings},(()=>{(t||n)&&this.forceUpdate((()=>{this.st4te._masonry.forceUpdate()}))}))}componentWillUnmount(){this.st4te._intervals.forEach((e=>{clearInterval(e)}));try{window.removeEventListener("resize",this._updated_dimensions)}catch(e){}try{i.default.findDOMNode(this).removeEventListener("keydown",this._handle_keydown)}catch(e){}}_recompute_cell_measurements=(e=()=>{})=>{const{_cell_measurer_cache:t,_masonry:n,_cell_positioner:o,_column_count:r,_gutter_size:s,_column_width:i}=this.st4te;if(null!=t&&null!=n&&null!=o){t.clearAll();let a={cellMeasurerCache:t,columnCount:r,columnWidth:i,spacer:s};o.reset(a),n.clearCellPositions(),this.setSt4te({_cell_positioner:o,_cell_positioner_config:a,_cell_measurer_cache:t},(()=>{n.forceUpdate(e)}))}else this._init_cell_measurements(e)};_set_masonry_ref=e=>{null!==e&&this.setSt4te({_masonry:e},(()=>{this._init_cell_measurements()}))};_set_root_ref=e=>{null!==e&&this.setSt4te({_root:e})};_cell_renderer=e=>{const{index:t,key:n,parent:o,style:r,isScrolling:s}=e,{_root_height:a,_root_width:l,_masonry:c,_column_width:d,_cell_measurer_cache:u,_column_count:p,_settings:f,_selected_post_index:m}=this.st4te;if(void 0===c.props.itemsWithSizes[0|t])return;const{item:g,size:x}=c.props.itemsWithSizes[0|t],y=c._scrollingContainer.scrollTop,b=m===t;if(!x.height)return;const w=t%p,A=(t-w)/p,v=Math.ceil(d*(x.height/x.width))||0;r.width=0+d;let{_top_scroll_of_el_by_index:S,_height_of_el_by_index:C,_x_y_of_el_by_index:E}=this.st4te;const R=0+r.top,B=0+r.height,k=R+B;S[t]=R,C[t]=B,E[t]=[A,w];const D=a*(a/l),P=D+k>y&&R<y+a+D,L=f._selected_locales_code;return this.setSt4te({_top_scroll_of_el_by_index:S,_height_of_el_by_index:C}),i.default.createElement(h.dl,{cache:u,index:t,key:n,parent:o},i.default.createElement(_.A,{onOpen:this._open_artwork,locales:L,nsfw:f._nsfw_enabled,data:g,renderer:f._renderer,onMenuClick:this.openCardMenu,is_scrolling:s,selected:b,size:x,visible:P,column_width:d,image_height:v,image_width:d,id:x.id,key:x.id,rowIndex:A,columnIndex:w,style:r}))};_init_cell_measurements=(e=()=>{})=>{this.forceUpdate((()=>{if(null!=this.st4te._cell_measurer_cache&&null!=this.st4te._cell_positioner_config&&null!=this.st4te._cell_positioner)this._recompute_cell_measurements(e);else{const{_column_count:t,_column_width:n,_gutter_size:o}=this.st4te;let r=new h.jS({defaultHeight:600,defaultWidth:n,fixedWidth:!0}),s={cellMeasurerCache:r,columnCount:t,columnWidth:n,spacer:o},i=(0,h.wT)(s);this.setSt4te({_cell_measurer_cache:r,_cell_positioner:i,_cell_positioner_config:s},(()=>{this.forceUpdate((()=>{const t=(e=()=>{})=>{const{_masonry:n}=this.st4te;n?n.forceUpdate(e):setTimeout((()=>{t(e)}),5)};t(e)}))}))}}))};_next_current_post=()=>{const{_post:e,_posts:t,_masonry:n}=this.st4te,o=t.map((e=>e.id)).indexOf(e.id)+1,r=Math.max(0,Math.min(t.length-1,o)),{item:s,size:i}=n.props.itemsWithSizes[0|r];console.log(s),this.setSt4te({_post:s},(()=>{this.forceUpdate(),this._update_selected_post_index(r)}))};_previous_current_post=()=>{const{_post:e,_posts:t,_masonry:n}=this.st4te,o=t.map((e=>e.id)).indexOf(e.id)-1,r=Math.max(0,Math.min(t.length-1,o)),{item:s,size:i}=n.props.itemsWithSizes[0|r];this.setSt4te({_post:s},(()=>{this.forceUpdate(),this._update_selected_post_index(r)}))};_handle_keydown=e=>{let{_masonry:t,_selected_post_index:n,_post_closed_at:o,_posts:r,_post_author:s,_post_permlink:i,_column_count:a,_x_y_of_el_by_index:l}=this.st4te;if(!s&&!i&&o+300<Date.now()){const t=n%a,o=(n-t)/a;let s=t,i=o;switch(e.keyCode){case 40:i+=1,e.preventDefault();break;case 38:i-=1,e.preventDefault();break;case 37:s-=1;break;case 39:s+=1}i===o&&s===t||l.forEach(((e,t)=>{e[1]===s&&i===e[0]&&(n=t)})),n=Math.max(0,Math.min(r.length-1,n)),13===e.keyCode||this.st4te._selected_post_index!==n&&this._update_selected_post_index(n)}};_update_selected_post_index=(e,t=!1)=>{const{_post:n,_posts:o,_masonry:r}=this.st4te;if(!r)return;const s=r.props.itemsWithSizes,i=void 0!==e?e:n?o.map((e=>(e||{}).title)).indexOf(n.title):this.st4te._selected_post_index;this.setSt4te({_selected_post_index:i,_post:o[i],_post_img:(s[i]||{}).size},(()=>{this.forceUpdate((()=>{t?r.forceUpdate():this._scroll_to_index()}))}))};_scroll_to=e=>{const{_masonry:t}=this.st4te;t&&(void 0===e?(t._scrollingContainer.scrollTop=this.st4te._scroll_top,t.forceUpdate()):this.setSt4te({_scroll_top:e},(()=>{t._scrollingContainer.scrollTop=e,t.forceUpdate()})))};_scroll_to_index=e=>{const{_selected_post_index:t,_top_scroll_of_el_by_index:n,_height_of_el_by_index:o,_root_height:r}=this.st4te;let s=n[e=void 0!==e?e:t]+o[e]/2-r/3;this._scroll_to(s)};_handle_masonry_scroll=e=>{const{_load_more_threshold:t,_loading_posts:n}=this.st4te,{_masonry:o,_scroll_top:r,_y:s}=this.st4te,i=o&&o._scrollingContainer?o._scrollingContainer.scrollTop:0,a=Math.min(Math.max(-64,s-(i-r)),64);r===i&&s===a||this.setSt4te({_scroll_top:i,_y:a},(()=>{s!==a&&this.forceUpdate()}))};handle_sorting_change=(e,t)=>{this.st4te.sorting!==t?this.setSt4te({sorting:t},(()=>{this.forceUpdate((()=>{this._scroll_to(0)}))})):this._scroll_to(0)};openCardMenu=(e,t)=>{this.setSt4te({menuCardXY:Int32Array.of(e.x-24,e.y-24),menuCardData:t},(()=>{this.forceUpdate()}))};closeCardMenu=()=>{this.setSt4te({menuCardXY:Int32Array.of(0,0),menuCardData:{}},(()=>{this.forceUpdate()}))};_open_create_artwork=()=>{this.setSt4te({_create_artwork_dialog_open:!0},(()=>{this.forceUpdate()}))};_create_artwork_dialog_close=()=>{this.setSt4te({_create_artwork_dialog_open:!1},(()=>{this.forceUpdate()}))};_open_artwork=e=>{this.setSt4te({_artwork_open:!0,_post:e},(()=>{this.forceUpdate()}))};_close_artwork=()=>{this.setSt4te({_artwork_open:!1,_post:{}},(()=>{this.forceUpdate()}))};render(){const{classes:e,_settings:t}=this.st4te;let{_less_than_960w:n,_less_than_690h:o,sorting:r,menuCardXY:s,menuCardData:a}=this.st4te,{_artwork_open:l,_post:c}=this.st4te;const{_window_width:d,_window_height:h,_cell_positioner:_,_cell_measurer_cache:y,_overscan_by_pixels:b,_y:w,_scroll_top:A,_posts:v,_create_artwork_dialog_open:S,_scrolling_reset_time_interval:C}=this.st4te,E=d>960?d-284:d,R=h-(d>960?96:64),B=t._selected_locales_code;return i.default.createElement(i.default.Fragment,null,i.default.createElement(f.A,{style:{transform:`translateY(${0>w&&A>72?-72:0}px)`},className:e.mainTab,value:r,variant:"fullWidth",indicatorColor:"primary",textColor:"primary",onChange:this.handle_sorting_change,fullwidth:!0},i.default.createElement(p.A,{label:"Created"}),i.default.createElement(p.A,{label:"Hot"}),i.default.createElement(p.A,{label:"Trending"}),i.default.createElement(p.A,{label:"Promoted"})),i.default.createElement("div",{ref:this._set_root_ref},i.default.createElement(u.A,{className:e.masonry,items:v,image:e=>e.image,keyMapper:e=>e.id},(e=>i.default.createElement(De,{key:"masonry-extended",scrollTop:A,scrollingResetTimeInterval:C,height:R,cellCount:0|(e||{}).length,itemsWithSizes:e,keyMapper:t=>(e[t]||{size:{id:Math.random()}}).size.id,cellMeasurerCache:y,cellPositioner:_,cellRenderer:this._cell_renderer,overscanByPixels:b,ref:this._set_masonry_ref,width:E})))),i.default.createElement("div",{onClick:this._open_create_artwork,className:e.mainFab,style:{transform:`translateY(${0<w&&A>512?72:0}px)`}},i.default.createElement(x.A,{variant:"extended"},i.default.createElement(g.A,{style:{marginRight:8}}),i.default.createElement("span",null,"CREATE"))),i.default.createElement(m.A,{xy:s,data:a,onClose:this.closeCardMenu}),i.default.createElement(ke,{keepMounted:!0,open:S,onClose:this._create_artwork_dialog_close}),i.default.createElement(J.A,{renderer:t._renderer,nsfw:t._nsfw_enabled,data:c,open:l,locales:B,onClose:this._close_artwork,onPrevious:this._previous_current_post,onNext:this._next_current_post}))}}const Le=(0,l.default)((e=>({mainTab:{backgroundColor:"#101010","& .MuiTab-textColorPrimary.Mui-selected":{backgroundColor:"transparent",color:"#989898"},"& .MuiTab-fullWidth":{backgroundColor:"transparent",color:"#989898",transition:"all 225ms cubic-bezier(0.4, 0, 0.2, 1) 0ms",borderRadius:"21px"},"& .MuiTab-fullWidth:hover":{backgroundColor:"rgba(255,255,255,0.06)"},"& span.MuiTabs-indicator":{zIndex:"-1",height:"48px",backgroundColor:"#3b3b3b",borderRadius:"21px"},margin:"21px 16px 21px 16px",width:"calc(100% - 32px)",borderRadius:"21px",position:"absolute",top:0,left:0,zIndex:1,transition:"transform 225ms cubic-bezier(0.4, 0, 0.2, 1) 225ms"},mainFab:{position:"fixed",right:16,bottom:16,transition:"transform 225ms cubic-bezier(0.4, 0, 0.2, 1) 225ms","& .MuiButtonBase-root":{borderRadius:"21px"}},masonry:{overflow:"hidden","& > .ReactVirtualized__Masonry":{willChange:"scroll-position !important",position:"absolute",margin:0,scrollBehavior:"smooth",overscrollBehavior:"none",touchAction:"pan-y",overflow:"hidden auto",padding:"66px 12px 32px 16px",contain:"style layout size paint","& > .ReactVirtualized__Masonry__innerScrollContainer":{top:"auto !important",left:"auto !important",contain:"layout size style paint"}}}})))(Pe)},37532:(e,t,n)=>{"use strict";var o,r;n.d(t,{A:()=>s}),o=n(36811),r=n(29411),o.A.addDefaultLocale(r.A);const s=new o.A("en-US")},20793:e=>{e.exports={functionString:"\n  var fu = function(image_data, scale) {\n\n    return new Promise(function (resolve, reject) {\n\n        var CRT = (function () {\n\n            \"use asm\";\n\n            var sqrt = Math.sqrt;\n            var cos = Math.cos;\n            var sin = Math.sin;\n            var min = Math.min;\n            var max = Math.max;\n            var imul = Math.imul;\n\n            function apply(imageData, srcx, srcy, scale, threshold) {\n\n                srcx = srcx | 0;\n                srcy = srcy | 0;\n                scale = scale | 0;\n                threshold = +threshold;\n\n                var Channels = 4;\n                var SizeX = srcx * scale | 0;\n                var SizeY = srcy * scale | 0;\n\n                var ScaledImage = new Uint8ClampedArray(SizeX * SizeY * Channels);\n\n                var total = SizeY | 0;\n                var current = 0;\n\n                var ppx = 0.0;\n                var ppy = 0.0;\n                var posx = 0;\n                var posy = 0;\n                var sub_posx = 0.0;\n                var sub_posy = 0.0;\n                var positionx = 0;\n                var positiony = 0;\n                var center = 0;\n                var left = 0;\n                var right = 0;\n                var midleft = 0;\n                var midright = 0;\n                var ret = 0;\n                var cr = 0;\n                var cg = 0;\n                var cb = 0;\n                var mlb = 0;\n                var mrr = 0;\n                var mrg = 0;\n                var lb = 0;\n                var rr = 0;\n                var rg = 0;\n                var alpha = 0;\n\n                for (var y = 0; y < SizeY; y = y + 1 | 0) {\n\n                    var offset = imul(y, SizeX) | 0;\n                    ppy = +(y / SizeY);\n\n                    for (var x = 0; x < SizeX; x = x + 1 | 0) {\n\n                        ppx = +(x / SizeX);\n                        posx = ~~(ppx * srcx);\n                        posy = ~~(ppy * srcy);\n                        sub_posx = +(ppx * srcx * 6) % 1.0;\n                        sub_posy = +(ppy * srcy * 6) % 1.0;\n                        positionx = posx | 0;\n                        positiony = posy | 0;\n\n                        center = CLR(imageData, srcx, srcy, positionx, positiony, 0, 0);\n                        left = CLR(imageData, srcx, srcy, positionx, positiony, -1, 0);\n                        right = CLR(imageData, srcx, srcy, positionx, positiony, 1, 0);\n\n                        if (sub_posy < 1.0 / 6.0) {\n\n                            center = mix(center, CLR(imageData, srcx, srcy, positionx, positiony, 0, -1), 0.5 - sub_posy / 2.0);\n                            left = mix(left, CLR(imageData, srcx, srcy, positionx, positiony, -1, -1), 0.5 - sub_posy / 2.0);\n                            right = mix(right, CLR(imageData, srcx, srcy, positionx, positiony, 1, -1), 0.5 - sub_posy / 2.0);\n\n                        } else if (sub_posy > 5.0 / 6.0) {\n\n                            center = mix(center, CLR(imageData, srcx, srcy, positionx, positiony, 0, 1), sub_posy / 2.0);\n                            left = mix(left, CLR(imageData, srcx, srcy, positionx, positiony, -1, 1), sub_posy / 2.0);\n                            right = mix(right, CLR(imageData, srcx, srcy, positionx, positiony, 1, 1), sub_posy / 2.0);\n                        }\n\n                        var scanline_multiplier;\n\n                        if (sub_posy < 0.5) {\n\n                            scanline_multiplier = (sub_posy * 2) * 0.3 + 0.7;\n\n                        } else {\n\n                            scanline_multiplier = ((1 - sub_posy) * 2) * 0.3 + 0.7;\n                        }\n\n                        Mul(center, scanline_multiplier);\n                        Mul(left, scanline_multiplier);\n                        Mul(right, scanline_multiplier);\n\n                        var odd = (ppx * srcx) & 1;\n\n                        var gradient_position;\n\n                        if (odd) {\n\n                            posy = +(posy + 0.5);\n                            posy = +(posy % 1.0);\n                        }\n\n                        if (posy < 1.0 / 3.0) {\n\n                            gradient_position = +(posy * 3.0);\n\n                            Mul(center, gradient_position * 0.6 + 0.4);\n                            Mul(left, gradient_position * 0.6 + 0.4);\n                            Mul(right, gradient_position * 0.6 + 0.4);\n\n                        } else if (posy > 2.0 / 3.0) {\n\n                            gradient_position = +(1 - posy) * 3.0;\n\n                            Mul(center, gradient_position * 0.6 + 0.4);\n                            Mul(left, gradient_position * 0.6 + 0.4);\n                            Mul(right, gradient_position * 0.6 + 0.4);\n                        }\n\n                        if (posx < 1.0 / 6.0 || posx > 5.0 / 6.0) {\n\n                            posy = +(posy + 0.5);\n                            posy = +(posy % 1.0);\n\n                            if (posy < 1.0 / 3.0) {\n\n                                gradient_position = +(posy * 3.0);\n\n                                if (posx < 0.5) {\n\n                                    gradient_position = +(1 - (1 - gradient_position) * (1 - (ppx) * 6.0));\n\n                                } else {\n\n                                    gradient_position = +(1 - (1 - gradient_position) * (1 - (1 - ppx) * 6.0));\n                                }\n\n                                Mul(center, gradient_position * 0.6 + 0.4);\n                                Mul(left, gradient_position * 0.6 + 0.4);\n                                Mul(right, gradient_position * 0.6 + 0.4);\n\n                            } else if (posy > 2.0 / 3.0) {\n\n                                gradient_position = +(1 - posy) * 3.0;\n\n                                if (posx < 0.5) {\n\n                                    gradient_position = +(1 - (1 - gradient_position) * (1 - (ppx) * 6.0));\n\n                                } else {\n\n                                    gradient_position = +(1 - (1 - gradient_position) * (1 - (1 - ppx) * 6.0));\n                                }\n\n                                Mul(center, gradient_position * 0.6 + 0.4);\n                                Mul(left, gradient_position * 0.6 + 0.4);\n                                Mul(right, gradient_position * 0.6 + 0.4);\n                            }\n                        }\n\n                        midleft = mix(left, center, 0.5);\n                        midright = mix(right, center, 0.5);\n\n                        cr = Red(center) | 0;\n                        cg = Green(center) | 0;\n                        cb = Blue(center) | 0;\n                        mlb = Blue(midleft) | 0;\n                        mrr = Red(midright) | 0;\n                        mrg = Green(midright) | 0;\n                        lb = Blue(left) | 0;\n                        rr = Red(right) | 0;\n                        rg = Green(right) | 0;\n                        alpha = Alpha(center) | 0;\n\n                        if (ppx < 1.0 / 6.0) {\n\n                            ret = mix(ARGBINT(alpha, cr * 255, cg * 255, lb * 255), ARGBINT(alpha, cr * 255, cg * 255, lb * 255), sub_posx);\n\n                        } else if (ppx < 2.0 / 6.0) {\n\n                            ret = mix(ARGBINT(alpha, cr * 255, cg * 255, lb * 255), ARGBINT(alpha, cr * 255, cg * 255, mlb * 255), sub_posx);\n\n                        } else if (ppx < 3.0 / 6.0) {\n\n                            ret = mix(ARGBINT(alpha, cr * 255, cg * 255, mlb * 255), ARGBINT(alpha, mrr * 255, cg * 255, cb * 255), sub_posx);\n\n                        } else if (ppx < 4.0 / 6.0) {\n\n                            ret = mix(ARGBINT(alpha, mrr * 255, cg * 255, cb * 255), ARGBINT(alpha, rr * 255, cg * 255, cb * 255), sub_posx);\n\n                        } else if (ppx < 5.0 / 6.0) {\n\n                            ret = mix(ARGBINT(alpha, rr * 255, cg * 255, cb * 255), ARGBINT(alpha, rr * 255, mrg * 255, cb * 255), sub_posx);\n\n                        } else {\n\n                            ret = mix(ARGBINT(alpha, rr * 255, mrg * 255, cb * 255), ARGBINT(alpha, rr * 255, rg * 255, cb * 255), sub_posx);\n                        }\n\n                        if (positionx < 1) {\n\n                            Mul(ret, positionx | 0);\n\n                        } else if (positionx > srcx - 1) {\n\n                            Mul(ret, srcx - positionx | 0);\n                        }\n\n                        if (positiony < 1) {\n\n                            Mul(ret, positiony | 0);\n\n                        } else if (positiony > srcy - 1) {\n\n                            Mul(ret, srcy - positiony | 0);\n                        }\n\n                        ScaledImage[offset * Channels] = Red(ret) | 0;\n                        ScaledImage[offset * Channels + 1] = Green(ret) | 0;\n                        ScaledImage[offset * Channels + 2] = Blue(ret) | 0;\n                        ScaledImage[offset * Channels + 3] = Alpha(ret) | 0;\n\n                    }\n\n                    current = current + 1 | 0;\n                }\n\n                return new ImageData(ScaledImage, SizeX, SizeY);\n            }\n\n            function mix(a, b, c) {\n\n                a = a | 0;\n                b = b | 0;\n                c = +c;\n\n                return ((a + ((b - a) * c)) | 0);\n            }\n\n            function Mul(x, y) {\n\n                x = x | 0;\n                y = +y;\n\n                return ((x * y) | 0);\n            }\n\n            function Red(rgb) {\n\n                rgb = rgb | 0;\n\n                return ((rgb >>> 16) & 0xFF) | 0;\n            }\n\n            function Green(rgb) {\n\n                rgb = rgb | 0;\n\n                return ((rgb >>> 8) & 0xFF) | 0;\n            }\n\n            function Blue(rgb) {\n\n                rgb = rgb | 0;\n\n                return (rgb & 0xFF) | 0;\n            }\n\n            function Alpha(rgb) {\n\n                rgb = rgb | 0;\n\n                return (rgb >>> 24) | 0;\n            }\n\n            function ARGBINT(a, r, g, b) {\n\n                a = a | 0;\n                r = r | 0;\n                g = g | 0;\n                b = b | 0;\n\n                return (((((a) << 24) | (r << 16) | (g << 8) | b) >>> 0) | 0);\n            }\n\n            function CLR(Input, srcx, srcy, x, y, dx, dy) {\n\n                Input = Input | 0;\n                srcx = srcx | 0;\n                srcy = srcy | 0;\n                x = x | 0;\n                y = y | 0;\n                dx = dx | 0;\n                dy = dy | 0;\n\n                var Channels = 4;\n\n                var xx = 0;\n                var yy = 0;\n\n                xx = (x + dx) | 0;\n                yy = (y + dy) | 0;\n\n                xx = max(0, min(srcx - 1, xx)) | 0;\n                yy = max(0, min(srcy - 1, yy)) | 0;\n\n                var index = 0;\n\n                index = ((yy * srcx + xx) * Channels) | 0;\n\n                var r = 0;\n                var g = 0;\n                var b = 0;\n                var a = 0;\n\n                r = (Input[index] | 0);\n                g = (Input[index + 1] | 0);\n                b = (Input[index + 2] | 0);\n                a = (Input[index + 3] | 0);\n\n                return ARGBINT(a, r, g, b) | 0;\n            }\n\n            return { Apply: apply };\n        }());\n\n        resolve(CRT.Apply(image_data.data, image_data.width, image_data.height, scale, 0));\n    });\n}\n\nfunction crt(image_data, scale) {\n    return new Promise(function(resolve, reject){\n        fu(image_data, scale).then((result) => {\n            resolve(result);\n        });\n    });\n}\n\n\n    self.onmessage = function onmessage(event) {\n        if (event.data.type === 'imageData') {\n            const result = crt(event.data.imageData, event.data.data.scale).then(function(result){\n                self.postMessage([result, event.data.id, event.data.algorithm]);\n            });\n        }\n    };\n",functionSize:function(e,t,n){return{width:e*n,height:t*n,arrayBufferLength:e*n*t*n*4}}}},95523:(e,t,n)=>{"use strict";function o(e,t,n){const o=e.createShader(t);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw console.error("Shader compilation failed:",e.getShaderInfoLog(o)),e.deleteShader(o),Error("Shader compilation error");return o}function r(e,t,n){void 0===y[n].data[t]&&g.compress(e.data).then((function(o){const r=new Uint8ClampedArray(o.buffer),s=r.byteLength;if(y[n].data[t]={data:r,width:e.width,height:e.height},y[n].timestamp[t]=0|Date.now(),b+=s,b>65536e5){const e=Object.keys(y[n].timestamp),t=Object.values(y[n].timestamp);let o=0|Date.now();for(let n=0,s=t.length;n<s;n++)t[n]<o&&(o=t[n]);const r=e[t.indexOf(o)];if(r){const e=0|y[n].data[r].data.byteLength;delete y[n].data[r],delete y[n].callbacks[r],delete y[n].timestamp[r],b-=e}}})),void 0!==y[n].callbacks[t]&&y[n].callbacks[t](e)}function s(e,t,n,s,i=!1,a){if(function(e){for(const t in y)t!==e&&(x.terminateWorker(t),y[t].callbacks={})}(e),y[e].callbacks[a]=s,void 0!==y[e].data[a]&&void 0!==y[e].callbacks[a]){const t=y[e].data[a];g.decompress(t.data).then((function(n){const o=new Uint8ClampedArray(n.buffer),r=new ImageData(o,t.width,t.height);y[e].callbacks[a](r)}))}else y[e].worker?x.sendDataToWorker(e,{data:t,scale:n},{type:"imageData",onReceive:r},a):"hex"===e&&r(function(e,t){if(!m)throw Error("WebGL not supported in this browser.");const{width:n,height:r}=_(e.width,e.height,t);f.width=n,f.height=r,m.viewport(0,0,m.drawingBufferWidth,m.drawingBufferHeight),function(e,t){const n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.width,t.height,0,e.RGBA,e.UNSIGNED_BYTE,t.data)}(m,e);const{hexSizeLocation:s,imageLocation:i}=function(e){const t=o(e,e.VERTEX_SHADER,"\n            attribute vec4 a_position;\n            varying vec2 v_uv;\n            void main() {\n                gl_Position = a_position;\n                v_uv = (a_position.xy + 1.0) / 2.0;\n            }\n        "),n=o(e,e.FRAGMENT_SHADER,"\n        precision mediump float;\n        \n        varying vec2 v_uv; // Interpolated UV coordinates from the vertex shader\n        uniform sampler2D u_image; // Uploaded image texture\n        uniform float u_hexSize; // Size of the hexagons\n        \n        vec2 hexAxialCoords(vec2 uv, float hexSize) {\n            float q = (uv.x * sqrt(3.0) / 3.0 - uv.y / 3.0) / hexSize;\n            float r = uv.y * 2.0 / 3.0 / hexSize;\n            return vec2(q, r);\n        }\n        \n        vec3 roundHex(vec3 hex) {\n            float q = floor(hex.x + 0.5);\n            float r = floor(hex.y + 0.5);\n            float s = floor(hex.z + 0.5);\n        \n            float dq = abs(q - hex.x);\n            float dr = abs(r - hex.y);\n            float ds = abs(s - hex.z);\n        \n            if (dq > dr && dq > ds) q = -r - s;\n            else if (dr > ds) r = -q - s;\n            else s = -q - r;\n        \n            return vec3(q, r, s);\n        }\n        \n        vec2 hexToUV(vec2 hex, float hexSize) {\n            float x = hexSize * sqrt(3.0) * (hex.x + 0.5 * hex.y);\n            float y = hexSize * 1.5 * hex.y;\n            return vec2(x, y);\n        }\n        \n        void main() {\n            // Use the UV coordinates directly, without flipping the Y-axis\n            vec2 flippedUV = v_uv;\n        \n            // Convert UV to hexagonal coordinates\n            vec2 hexCoords = hexAxialCoords(flippedUV, u_hexSize);\n        \n            // Round to the nearest hex center\n            vec3 roundedHex = roundHex(vec3(hexCoords, -hexCoords.x - hexCoords.y));\n        \n            // Convert back to UV coordinates for texture sampling\n            vec2 sampledUV = hexToUV(roundedHex.xy, u_hexSize);\n                 sampledUV = clamp(sampledUV, vec2(0.0), vec2(1.0));\n\n            // Sample the texture and output the color\n            gl_FragColor = texture2D(u_image, sampledUV);\n        }\n\n    "),r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))return void console.error("Program failed to link:",e.getProgramInfoLog(r));e.useProgram(r);const s=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,s),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW);const i=e.getAttribLocation(r,"a_position");return e.enableVertexAttribArray(i),e.vertexAttribPointer(i,2,e.FLOAT,!1,0,0),{program:r,hexSizeLocation:e.getUniformLocation(r,"u_hexSize"),imageLocation:e.getUniformLocation(r,"u_image")}}(m);m.uniform1f(s,t/f.width),m.uniform1i(i,0),m.drawArrays(m.TRIANGLES,0,6);const a=new ImageData(n,r);return m.readPixels(0,0,n,r,m.RGBA,m.UNSIGNED_BYTE,a.data),a}(t,n),a,e)}function i(e,t,n,o,r){s("xbrz",e,t,n,o,r)}function a(e,t,n,o,r){s("hex",e,t,n,o,r)}function l(e,t,n,o,r){s("crt",e,t,n,o,r)}var c,d,h,u;n.d(t,{E6:()=>l,eu:()=>a,px:()=>i}),c=n(92466),d=n.n(c);const _=(e,t,n)=>{const o=e*n,r=o/(e/t);return{width:Math.ceil(o),height:Math.ceil(r)}},p=document.getElementById("webgl-hexagon-renderer");let f=null;p?f=p:(f=document.createElement("canvas"),f.style.display="none",f.id="webgl-hexagon-renderer",document.body.appendChild(f));const m=f.getContext("webgl",{antialias:!1,powerPreference:"high-performance",desynchronized:!0});h=n(20793),u=n.n(h);class g{static async compress(e){const t="string"==typeof e?(new TextEncoder).encode(e):e,n=new CompressionStream("deflate"),o=n.writable.getWriter();return o.write(t),o.close(),await this._streamToUint8Array(n.readable)}static async decompress(e){const t=new DecompressionStream("deflate"),n=t.writable.getWriter();return n.write(e),n.close(),await this._streamToUint8Array(t.readable)}static async _streamToUint8Array(e){const t=e.getReader(),n=[];let o=0;for(;;){const{value:e,done:r}=await t.read();if(r)break;n.push(e),o+=e.length}const r=new Uint8Array(o);let s=0;for(const i of n)r.set(i,s),s+=i.length;return r}}const x=new class{constructor(e){this.workers=new Map,this.workerScripts=e}createWorker(e,t,n=!1){if(this.workers.has(e))return this.workers.get(e).worker;const o=new Blob([t],{type:"application/javascript"}),r=URL.createObjectURL(o);let s;return s=n?new SharedWorker(r):new Worker(r),this.workers.set(e,{worker:s,type:n?"shared":"dedicated"}),s}sendDataToWorker(e,t,n={},o){let r=this.workers.get(e);if(!r){if(void 0===this.workerScripts[e])throw Error(`Worker ${e} not found`);r=this.createWorker(e,this.workerScripts[e],!1)}const{worker:s,type:i}=r,a={type:n.type||"default",data:t,id:o,algorithm:e},l=[];if("canvas"===n.type){const e=n.canvas.transferControlToOffscreen();a.canvas=e,l.push(e)}else"sharedBuffer"===n.type?(a.sharedArrayBuffer=n.sharedArrayBuffer,l.push(n.sharedArrayBuffer)):"imageData"===n.type&&(a.imageData=t.data);"dedicated"===i?s.postMessage(a,l):"shared"===i&&(s.port.postMessage(a,l),s.port.start()),"dedicated"===i?s.onmessage=e=>{n.onReceive&&n.onReceive(e.data[0],e.data[1],e.data[2])}:"shared"===i&&(s.port.onmessage=e=>{n.port.onReceive&&n.port.onReceive(e.data[0],e.data[1],e.data[2])})}terminateWorker(e){const t=this.workers.get(e);t&&("dedicated"===t.type?t.worker.terminate():"shared"===t.type&&t.worker.port.close(),this.workers.delete(e))}}({xbrz:d().functionString,crt:u().functionString});let y={xbrz:{worker:!0,callbacks:{},data:{},timestamp:{}},hex:{worker:!1,callbacks:{},data:{},timestamp:{}},crt:{worker:!0,callbacks:{},data:{},timestamp:{}}},b=0},92466:e=>{"use strict";e.exports={functionString:'\n  \nvar xbrzrender = function xbrzrender(image_data, scale) {\n        "use strict";\n    class PixelData {\n        constructor(obj, width) {\n            if (obj instanceof ImageData) {\n                this.data = new Uint32Array(obj.data.buffer)\n                this.width = obj.width\n                this.height = obj.height\n            } else if (typeof obj === "number") {\n                if (typeof width !== "undefined" && typeof width !== null) {\n                    this.data = new Uint32Array(obj)\n                    this.width = width\n                }\n            }\n        }\n\n        setDistSize(scale) {\n            this.dist = new Uint32Array(this.data.length * scale ** 2)\n            this.targetScale = scale\n        }\n\n        getSourcePoint(x, v, u) {\n            if (\n                x + u < this.width * Math.floor(x / this.width) ||\n                x + u > this.width * Math.floor(x / this.width + 1) - 1\n            ) {\n                // u1\n                u += u === 0 ? 0 : u > 0 ? -1 : 1\n            }\n\n            if (\n                x + this.width * v + u < 0 ||\n                x + this.width * v + u >= this.data.length\n            ) {\n                // \n                v += v === 0 ? 0 : v > 0 ? -1 : 1\n                if (u === 0 && v === 0) {\n                    return this.data[x + this.width * v + u]\n                }\n                return this.getSourcePoint(x, v, u)\n                //\n            } else {\n                return this.data[x + this.width * v + u]\n            }\n        }\n\n        setDistPoint(topleft, v, u, value) {\n            this.dist[topleft + this.width * this.targetScale * v + u] = value\n        }\n\n        getDistPoint(trg) {\n            return this.dist[trg]\n        }\n\n        outImageData() {\n            const outData = new Uint8ClampedArray(this.dist.buffer)\n            // console.log(this.targetScale)\n            return new ImageData(outData, this.width * this.targetScale)\n        }\n\n        outImageDataURL() {\n            const id = this.outImageData()\n            const canvas = document.createElement("canvas")\n            const ctx = canvas.getContext("2d")\n            if (ctx) {\n                ctx.canvas.width = id.width\n                ctx.canvas.height = id.height\n                ctx.putImageData(id, 0, 0)\n                return canvas.toDataURL()\n            } else {\n                return ""\n            }\n        }\n\n        // X\n        static getR(X) {\n            return X & 0xff\n        }\n        static getG(X) {\n            return (X >> 8) & 0xff\n        }\n        static getB(X) {\n            return (X >> 16) & 0xff\n        }\n        static getA(X) {\n            return X >> 24\n        }\n\n        // \n        static Interpolate(A, B, C, D) {\n            const A_a = A >> 24\n            const A_b = (A >> 16) & 0xff\n            const A_g = (A >> 8) & 0xff\n            const A_r = A & 0xff\n            const B_a = B >> 24\n            const B_b = (B >> 16) & 0xff\n            const B_g = (B >> 8) & 0xff\n            const B_r = B & 0xff\n\n            if (C !== undefined && D !== undefined) {\n                const C_a = C >> 24\n                const C_b = (C >> 16) & 0xff\n                const C_g = (C >> 8) & 0xff\n                const C_r = C & 0xff\n                const D_a = D >> 24\n                const D_b = (D >> 16) & 0xff\n                const D_g = (D >> 8) & 0xff\n                const D_r = D & 0xff\n\n                return (\n                    (((A_a + B_a + C_a + D_a) >> 2) << 24) |\n                    (((A_b + B_b + C_b + D_b) >> 2) << 16) |\n                    (((A_g + B_g + C_g + D_g) >> 2) << 8) |\n                    ((A_r + B_r + C_r + D_r) >> 2)\n                )\n                //\n            } else if (C !== undefined && D === undefined) {\n                const C_a = C >> 24\n                const C_b = (C >> 16) & 0xff\n                const C_g = (C >> 8) & 0xff\n                const C_r = C & 0xff\n\n                return (\n                    (Math.floor((A_a + B_a + C_a) / 3) << 24) |\n                    (Math.floor((A_b + B_b + C_b) / 3) << 16) |\n                    (Math.floor((A_g + B_g + C_g) / 3) << 8) |\n                    Math.floor((A_r + B_r + C_r) / 3)\n                )\n                //\n            } else {\n                return (\n                    (((A_a + B_a) >> 1) << 24) |\n                    (((A_b + B_b) >> 1) << 16) |\n                    (((A_g + B_g) >> 1) << 8) |\n                    ((A_r + B_r) >> 1)\n                )\n            }\n        }\n\n        static InterpolateWeighted2(A, B, f1, f2) {\n            let total = f1 + f2\n\n            const A_a = A >> 24\n            const A_b = (A >> 16) & 0xff\n            const A_g = (A >> 8) & 0xff\n            const A_r = A & 0xff\n            const B_a = B >> 24\n            const B_b = (B >> 16) & 0xff\n            const B_g = (B >> 8) & 0xff\n            const B_r = B & 0xff\n\n            return (\n                (Math.floor((A_a * f1 + B_a * f2) / total) << 24) |\n                (Math.floor((A_b * f1 + B_b * f2) / total) << 16) |\n                (Math.floor((A_g * f1 + B_g * f2) / total) << 8) |\n                Math.floor((A_r * f1 + B_r * f2) / total)\n            )\n        }\n\n        static InterpolateWeighted3(A, B, C, f1, f2, f3) {\n            let total = f1 + f2 + f3\n\n            const A_a = A >> 24\n            const A_b = (A >> 16) & 0xff\n            const A_g = (A >> 8) & 0xff\n            const A_r = A & 0xff\n            const B_a = B >> 24\n            const B_b = (B >> 16) & 0xff\n            const B_g = (B >> 8) & 0xff\n            const B_r = B & 0xff\n            const C_a = C >> 24\n            const C_b = (C >> 16) & 0xff\n            const C_g = (C >> 8) & 0xff\n            const C_r = C & 0xff\n\n            return (\n                (Math.floor((A_a * f1 + B_a * f2 + C_a * f3) / total) << 24) |\n                (Math.floor((A_b * f1 + B_b * f2 + C_b * f3) / total) << 16) |\n                (Math.floor((A_g * f1 + B_g * f2 + C_g * f3) / total) << 8) |\n                Math.floor((A_r * f1 + B_r * f2 + C_r * f3) / total)\n            )\n        }\n\n        static InterpolateWeighted4(A, B, C, D, w1, w2, w3, w4) {\n            let total = w1 + w2 + w3 + w4\n\n            const A_a = A >> 24\n            const A_b = (A >> 16) & 0xff\n            const A_g = (A >> 8) & 0xff\n            const A_r = A & 0xff\n            const B_a = B >> 24\n            const B_b = (B >> 16) & 0xff\n            const B_g = (B >> 8) & 0xff\n            const B_r = B & 0xff\n            const C_a = C >> 24\n            const C_b = (C >> 16) & 0xff\n            const C_g = (C >> 8) & 0xff\n            const C_r = C & 0xff\n            const D_a = D >> 24\n            const D_b = (D >> 16) & 0xff\n            const D_g = (D >> 8) & 0xff\n            const D_r = D & 0xff\n\n            return (\n                (Math.floor((A_a * w1 + B_a * w2 + C_a * w3 + D_a * w4) / total) << 24) |\n                (Math.floor((A_b * w1 + B_b * w2 + C_b * w3 + D_b * w4) / total) << 16) |\n                (Math.floor((A_g * w1 + B_g * w2 + C_g * w3 + D_g * w4) / total) << 8) |\n                Math.floor((A_r * w1 + B_r * w2 + C_r * w3 + D_r * w4) / total)\n            )\n        }\n    }\n\n    var BlendType\n\n    ;(function(BlendType) {\n        BlendType[(BlendType["BlendNone"] = 0)] = "BlendNone"\n        BlendType[(BlendType["BlendNormal"] = 1)] = "BlendNormal"\n        BlendType[(BlendType["BlendDominant"] = 2)] = "BlendDominant"\n    })(BlendType || (BlendType = {}))\n\n    class BlendInfo {\n        static GetTopL(b) {\n            return b & 0x3\n        }\n\n        static GetTopR(b) {\n            return (b >> 2) & 0x3\n        }\n\n        static GetBottomR(b) {\n            return (b >> 4) & 0x3\n        }\n\n        static GetBottomL(b) {\n            return (b >> 6) & 0x3\n        }\n\n        static SetTopL(b, bt) {\n            return b | bt\n        }\n\n        static SetTopR(b, bt) {\n            return b | (bt << 2)\n        }\n\n        static SetBottomR(b, bt) {\n            return b | (bt << 4)\n        }\n\n        static SetBottomL(b, bt) {\n            return b | (bt << 6)\n        }\n\n        static Rotate(b, rotDeg) {\n            const l = rotDeg << 1\n            const r = 8 - l\n            return ((b << l) | (b >> r)) & 0xff // eslint-disable-line\n        }\n    }\n\n    var RotationDegree\n\n    ;(function(RotationDegree) {\n        RotationDegree[(RotationDegree["Rot0"] = 0)] = "Rot0"\n        RotationDegree[(RotationDegree["Rot90"] = 1)] = "Rot90"\n        RotationDegree[(RotationDegree["Rot180"] = 2)] = "Rot180"\n        RotationDegree[(RotationDegree["Rot270"] = 3)] = "Rot270"\n    })(RotationDegree || (RotationDegree = {}))\n\n    class Rot {\n        // 4\n        static _ = new Uint32Array(9 * 4)\n\n        static Rot() {\n            const a = 0\n            const b = 1\n            const c = 2\n            const d = 3\n            const e = 4\n            const f = 5\n            const g = 6\n            const h = 7\n            const i = 8\n\n            // eslint-disable-next-line prettier/prettier\n            const deg0 = [a, b, c, d, e, f, g, h, i]\n            // eslint-disable-next-line prettier/prettier\n            const deg90 = [g, d, a, h, e, b, i, f, c]\n            // eslint-disable-next-line prettier/prettier\n            const deg180 = [i, h, g, f, e, d, c, b, a]\n            // eslint-disable-next-line prettier/prettier\n            const deg270 = [c, f, i, b, e, h, a, d, g]\n            // eslint-disable-next-line prettier/prettier\n            const rotation = [deg0, deg90, deg180, deg270]\n\n            for (let rotDeg = 0; rotDeg < 4; rotDeg++) {\n                for (let x = 0; x < 9; x++) {\n                    this._[(x << 2) + rotDeg] = rotation[rotDeg][x]\n                }\n            }\n        }\n    }\n\n    function MatrixRotation(rotDeg, I, J, N) {\n        const struct = {\n            I_old: 0,\n            J_old: 0\n        }\n\n        if (rotDeg === RotationDegree.Rot0) {\n            struct.I_old = I\n            struct.J_old = J\n        } else {\n            const old = MatrixRotation(rotDeg - 1, I, J, N)\n            struct.I_old = N - 1 - old.J_old\n            struct.J_old = old.I_old\n        }\n\n        return struct\n    }\n\n    class OutputSystem {\n        _rotDeg = 0\n        _targetIndex = 0\n\n        constructor(p, scale, outWidth) {\n            this._p = p\n            this._scaleN = scale\n            this._outWidth = outWidth\n        }\n\n        TargetMove(rotDeg, trgi) {\n            this._rotDeg = rotDeg\n            this._targetIndex = trgi\n        }\n\n        Reference(i, j) {\n            const rot = MatrixRotation(this._rotDeg, i, j, this._scaleN)\n            return this._targetIndex + rot.J_old + rot.I_old * this._outWidth\n        }\n\n        getDstPixel(trgi) {\n            return this._p.getDistPoint(trgi)\n        }\n\n        SetDstPixel(trgi, BlendedCol) {\n            this._p.setDistPoint(trgi, 0, 0, BlendedCol)\n        }\n\n        outImage() {\n            return this._p.outImageData()\n        }\n    }\n\n    class XBRz {\n        static luminanceWeight = 1\n        static equalColorTolerance = 30\n        static centerDirectionBias = 4\n        static dominantDirectionThreshold = 3.6\n        static steepDirectionThreshold = 2.2\n\n        static XBRZ(imageData, scale) {\n            const p = new PixelData(imageData)\n            p.setDistSize(scale)\n\n            Rot.Rot() // init static Rot class\n\n            let scaler = new Scale2x()\n            if (scale === 3) {\n                scaler = new Scale3x()\n            } else if (scale === 4) {\n                scaler = new Scale4x()\n            } else if (scale === 5) {\n                scaler = new Scale5x()\n            } else if (scale === 6) {\n                scaler = new Scale6x()\n            }\n\n            const trgWidth = p.width * scale\n            const preProcBuffer = new Uint8Array(p.width)\n            const outputSystem = new OutputSystem(p, scale, trgWidth)\n            // initialize preprocessing buffer for first row:\n            // detect upper left and right corner blending\n            // this cannot be optimized for adjacent processing\n            // stripes; we must not allow for a memory race condition!\n            for (let i = 0; i < p.width; i++) {\n                const l = 0 * p.width + i\n                // center is f\n                // a  b  c  d\n                // e  f  g  h\n                // i  j  k  l\n                // m  n  o  p\n                const ker4 = {\n                    a: p.getSourcePoint(l, -1, -1),\n                    b: p.getSourcePoint(l, -1, 0),\n                    c: p.getSourcePoint(l, -1, 1),\n                    d: p.getSourcePoint(l, -1, 2),\n                    e: p.getSourcePoint(l, 0, -1),\n                    f: p.getSourcePoint(l, 0, 0),\n                    g: p.getSourcePoint(l, 0, 1),\n                    h: p.getSourcePoint(l, 0, 2),\n                    i: p.getSourcePoint(l, 1, -1),\n                    j: p.getSourcePoint(l, 1, 0),\n                    k: p.getSourcePoint(l, 1, 1),\n                    l: p.getSourcePoint(l, 1, 2),\n                    m: p.getSourcePoint(l, 2, -1),\n                    n: p.getSourcePoint(l, 2, 0),\n                    o: p.getSourcePoint(l, 2, 1),\n                    p: p.getSourcePoint(l, 2, 2)\n                }\n\n                const blendResult = {\n                    f: 0,\n                    g: 0,\n                    j: 0,\n                    k: 0\n                }\n\n                this._preProcessCorners(ker4, blendResult)\n                /*\n                preprocessing blend result:\n                ---------\n                | F | G | //evalute corner between F, G, J, K\n                ----|---| //input pixel is at position F\n                | J | K |\n                ---------\n                */\n                preProcBuffer[i] = BlendInfo.SetTopR(preProcBuffer[i], blendResult.j)\n\n                if (i + 1 < p.width) {\n                    // eslint-disable-next-line prettier/prettier\n                    preProcBuffer[i + 1] = BlendInfo.SetTopL(\n                        preProcBuffer[i + 1],\n                        blendResult.k\n                    )\n                }\n            }\n\n            for (let j = 0; j < p.height; j++) {\n                let trgi = scale * j * trgWidth // target Y index\n                let blendXy1 = 0\n\n                for (let i = 0; i < p.width; i++, trgi += scale) {\n                    const l = j * p.width + i\n                    let blendXy = 0\n\n                    const ker4 = {\n                        a: p.getSourcePoint(l, -1, -1),\n                        b: p.getSourcePoint(l, -1, 0),\n                        c: p.getSourcePoint(l, -1, 1),\n                        d: p.getSourcePoint(l, -1, 2),\n                        e: p.getSourcePoint(l, 0, -1),\n                        f: p.getSourcePoint(l, 0, 0),\n                        g: p.getSourcePoint(l, 0, 1),\n                        h: p.getSourcePoint(l, 0, 2),\n                        i: p.getSourcePoint(l, 1, -1),\n                        j: p.getSourcePoint(l, 1, 0),\n                        k: p.getSourcePoint(l, 1, 1),\n                        l: p.getSourcePoint(l, 1, 2),\n                        m: p.getSourcePoint(l, 2, -1),\n                        n: p.getSourcePoint(l, 2, 0),\n                        o: p.getSourcePoint(l, 2, 1),\n                        p: p.getSourcePoint(l, 2, 2)\n                    }\n\n                    const blendResult = {\n                        f: 0,\n                        g: 0,\n                        j: 0,\n                        k: 0\n                    }\n\n                    this._preProcessCorners(ker4, blendResult)\n                    /*\n                    preprocessing blend result:\n                    ---------\n                    | F | G | //evalute corner between F, G, J, K\n                    ----|---| //input pixel is at position F\n                    | J | K |\n                    ---------\n                    */\n\n                    // all four corners of (x, y) have been determined at\n                    // this point due to processing sequence!\n                    blendXy = BlendInfo.SetBottomR(preProcBuffer[i], blendResult.f)\n\n                    // set 2nd known corner for (x, y + 1)\n                    blendXy1 = BlendInfo.SetTopR(blendXy1, blendResult.j)\n                    // store on current buffer position for use on next row\n                    preProcBuffer[i] = blendXy1\n\n                    // set 1st known corner for (x + 1, y + 1) and\n                    // buffer for use on next column\n                    blendXy1 = BlendInfo.SetTopL(0, blendResult.k)\n\n                    if (i + 1 < p.width) {\n                        preProcBuffer[i + 1] = BlendInfo.SetBottomL(\n                            preProcBuffer[i + 1],\n                            blendResult.g\n                        )\n                    }\n\n                    //  f \n                    this._FillBlock(outputSystem, trgi, trgWidth, ker4.f, scale)\n\n                    if (blendXy === 0) continue\n\n                    const ker3 = new Uint32Array(9)\n                    ker3[0] = ker4.a\n                    ker3[1] = ker4.b\n                    ker3[2] = ker4.c\n\n                    ker3[3] = ker4.e\n                    ker3[4] = ker4.f\n                    ker3[5] = ker4.g\n\n                    ker3[6] = ker4.i\n                    ker3[7] = ker4.j\n                    ker3[8] = ker4.k\n\n                    this._BlendPixel(\n                        scaler,\n                        RotationDegree.Rot0,\n                        ker3,\n                        outputSystem,\n                        trgi,\n                        blendXy\n                    )\n                    this._BlendPixel(\n                        scaler,\n                        RotationDegree.Rot90,\n                        ker3,\n                        outputSystem,\n                        trgi,\n                        blendXy\n                    )\n                    this._BlendPixel(\n                        scaler,\n                        RotationDegree.Rot180,\n                        ker3,\n                        outputSystem,\n                        trgi,\n                        blendXy\n                    )\n                    this._BlendPixel(\n                        scaler,\n                        RotationDegree.Rot270,\n                        ker3,\n                        outputSystem,\n                        trgi,\n                        blendXy\n                    )\n                } // end x for\n            } // end y for\n            return outputSystem.outImage()\n        }\n\n        static _BlendPixel(scaler, rotDeg, ker, outputSystem, trgi, blendInfo) {\n            const b = ker[Rot._[(1 << 2) + rotDeg]]\n            const c = ker[Rot._[(2 << 2) + rotDeg]]\n            const d = ker[Rot._[(3 << 2) + rotDeg]]\n            const e = ker[Rot._[(4 << 2) + rotDeg]]\n            const f = ker[Rot._[(5 << 2) + rotDeg]]\n            const g = ker[Rot._[(6 << 2) + rotDeg]]\n            const h = ker[Rot._[(7 << 2) + rotDeg]]\n            const i = ker[Rot._[(8 << 2) + rotDeg]]\n\n            const blend = BlendInfo.Rotate(blendInfo, rotDeg)\n\n            if (BlendInfo.GetBottomR(blend) === BlendType.BlendNone) {\n                return\n            }\n\n            const eq = (pix1, pix2) => {\n                return this._ColorDist(pix1, pix2) < this.equalColorTolerance\n            }\n            const dist = (pix1, pix2) => {\n                return this._ColorDist(pix1, pix2)\n            }\n            let doLineBlend\n\n            if (BlendInfo.GetBottomR(blend) >= BlendType.BlendDominant) {\n                doLineBlend = true\n\n                // make sure there is no second blending in an adjacent\n                // rotation for this pixel: handles insular pixels, mario eyes\n                // but support double-blending for 90? corners\n            } else if (BlendInfo.GetTopR(blend) !== BlendType.BlendNone && !eq(e, g)) {\n                doLineBlend = false\n            } else if (\n                BlendInfo.GetBottomL(blend) !== BlendType.BlendNone &&\n                !eq(e, c)\n            ) {\n                doLineBlend = false\n\n                // no full blending for L-shapes; blend corner only (handles "mario mushroom eyes")\n            } else if (!eq(e, i) && eq(g, h) && eq(h, i) && eq(i, f) && eq(f, c)) {\n                doLineBlend = false\n            } else {\n                doLineBlend = true\n            }\n\n            // \n            const px = dist(e, f) <= dist(e, h) ? f : h\n\n            outputSystem.TargetMove(rotDeg, trgi) // \n\n            if (doLineBlend) {\n                const fg = dist(f, g)\n                const hc = dist(h, c)\n\n                const haveShallowLine =\n                    this.steepDirectionThreshold * fg <= hc && e !== g && d !== g\n                const haveSteepLine =\n                    this.steepDirectionThreshold * hc <= fg && e !== c && b !== c\n\n                if (haveShallowLine) {\n                    if (haveSteepLine) {\n                        // eslint-disable-next-line prettier/prettier\n                        scaler.BlendLineSteepAndShallow(px, outputSystem)\n                    } else {\n                        // eslint-disable-next-line prettier/prettier\n                        scaler.BlendLineShallow(px, outputSystem)\n                    }\n                } else if (haveSteepLine) {\n                    scaler.BlendLineSteep(px, outputSystem)\n                } else {\n                    scaler.BlendLineDiagonal(px, outputSystem)\n                }\n            } else {\n                scaler.BlendCorner(px, outputSystem)\n            }\n        }\n\n        static _FillBlock(out, trgi, pitch, col, blocksize) {\n            for (let y = 0; y < blocksize; ++y, trgi += pitch) {\n                for (let x = 0; x < blocksize; ++x) {\n                    out.SetDstPixel(trgi + x, col)\n                }\n            }\n        }\n\n        static _Square(x) {\n            return x * x\n        }\n\n        static _DistYCbCr(pix1, pix2) {\n            const rDiff = PixelData.getR(pix1) - PixelData.getR(pix2)\n            const gDiff = PixelData.getG(pix1) - PixelData.getG(pix2)\n            const bDiff = PixelData.getB(pix1) - PixelData.getB(pix2)\n\n            // const kB = 0.0722 // ITU-R BT.709\n            // const kR = 0.2126\n            const kB = 0.0593 // ITU-R BT.2020\n            const kR = 0.2627 //\n            const kG = 1 - kB - kR\n\n            const scaleB = 0.5 / (1 - kB)\n            const scaleR = 0.5 / (1 - kR)\n\n            const y = kR * rDiff + kG * gDiff + kB * bDiff\n            const cB = scaleB * (bDiff - y)\n            const cR = scaleR * (rDiff - y)\n\n            return Math.sqrt(\n                this._Square(this.luminanceWeight * y) +\n                this._Square(cB) +\n                this._Square(cR)\n            )\n            // return this._Square(this.luminanceWeight * y) + this._Square(cB) + this._Square(cR)\n        }\n\n        static _ColorDist(pix1, pix2) {\n            return pix1 === pix2 ? 0 : this._DistYCbCr(pix1, pix2)\n        }\n\n        static _preProcessCorners(ker, blendResult) {\n            if (\n                (ker.f === ker.g && ker.j === ker.k) ||\n                (ker.f === ker.j && ker.g === ker.k)\n            ) {\n                blendResult.f = BlendType.BlendNone\n                blendResult.g = BlendType.BlendNone\n                blendResult.j = BlendType.BlendNone\n                blendResult.k = BlendType.BlendNone\n                return\n            }\n\n            // const dist = this._ColorDist\n            const jg =\n                this._ColorDist(ker.i, ker.f) +\n                this._ColorDist(ker.f, ker.c) +\n                this._ColorDist(ker.n, ker.k) +\n                this._ColorDist(ker.k, ker.h) +\n                this.centerDirectionBias * this._ColorDist(ker.j, ker.g)\n            const fk =\n                this._ColorDist(ker.e, ker.j) +\n                this._ColorDist(ker.j, ker.o) +\n                this._ColorDist(ker.b, ker.g) +\n                this._ColorDist(ker.g, ker.l) +\n                this.centerDirectionBias * this._ColorDist(ker.f, ker.k)\n\n            if (jg < fk) {\n                const dominantGradient = this.dominantDirectionThreshold * jg < fk\n                if (ker.f !== ker.g && ker.f !== ker.j) {\n                    blendResult.f = dominantGradient\n                        ? BlendType.BlendDominant\n                        : BlendType.BlendNormal\n                }\n                if (ker.k !== ker.j && ker.k !== ker.g) {\n                    blendResult.k = dominantGradient\n                        ? BlendType.BlendDominant\n                        : BlendType.BlendNormal\n                }\n            } else if (fk < jg) {\n                const dominantGradient = this.dominantDirectionThreshold * fk < jg\n                if (ker.j !== ker.f && ker.j !== ker.k) {\n                    blendResult.j = dominantGradient\n                        ? BlendType.BlendDominant\n                        : BlendType.BlendNormal\n                }\n                if (ker.g !== ker.f && ker.g !== ker.k) {\n                    blendResult.g = dominantGradient\n                        ? BlendType.BlendDominant\n                        : BlendType.BlendNormal\n                }\n            }\n        }\n    }\n\n/// /////////////////////\n// BLENDING\n/// /////////////////////\n    function _AlphaBlend(n, m, target, out, color) {\n        const ip = PixelData.InterpolateWeighted2(\n            color,\n            out.getDstPixel(target),\n            n,\n            m - n\n        )\n        out.SetDstPixel(target, ip)\n    }\n\n    class Scale2x {\n        _SCALE = 2\n\n        Scale() {\n            return this._SCALE\n        }\n\n        BlendLineShallow(color, out) {\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 1, 0), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 1, 1), out, color)\n        }\n\n        BlendLineSteep(color, out) {\n            _AlphaBlend(1, 4, out.Reference(0, this._SCALE - 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(1, this._SCALE - 1), out, color)\n        }\n\n        BlendLineSteepAndShallow(color, out) {\n            _AlphaBlend(1, 4, out.Reference(1, 0), out, color)\n            _AlphaBlend(1, 4, out.Reference(0, 1), out, color)\n            _AlphaBlend(5, 6, out.Reference(1, 1), out, color)\n        }\n\n        BlendLineDiagonal(color, out) {\n            _AlphaBlend(1, 2, out.Reference(1, 1), out, color)\n        }\n\n        BlendCorner(color, out) {\n            // \n            _AlphaBlend(21, 100, out.Reference(1, 1), out, color) // exact: 1 - pi/4 = 0.2146018366\n        }\n    }\n\n    class Scale3x {\n        _SCALE = 3\n\n        Scale() {\n            return this._SCALE\n        }\n\n        BlendLineShallow(color, out) {\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 1, 0), out, color)\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 2, 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 1, 1), out, color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 2), color)\n        }\n\n        BlendLineSteep(color, out) {\n            _AlphaBlend(1, 4, out.Reference(0, this._SCALE - 1), out, color)\n            _AlphaBlend(1, 4, out.Reference(2, this._SCALE - 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(1, this._SCALE - 1), out, color)\n            out.SetDstPixel(out.Reference(2, this._SCALE - 1), color)\n        }\n\n        BlendLineSteepAndShallow(color, out) {\n            _AlphaBlend(1, 4, out.Reference(2, 0), out, color)\n            _AlphaBlend(1, 4, out.Reference(0, 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(2, 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(1, 2), out, color)\n            out.SetDstPixel(out.Reference(2, 2), color)\n        }\n\n        BlendLineDiagonal(color, out) {\n            _AlphaBlend(1, 8, out.Reference(1, 2), out, color)\n            _AlphaBlend(1, 8, out.Reference(2, 1), out, color)\n            _AlphaBlend(7, 8, out.Reference(2, 2), out, color)\n        }\n\n        BlendCorner(color, out) {\n            // \n            _AlphaBlend(45, 100, out.Reference(2, 2), out, color) // exact: 0.4545939598\n            // alphaBlend(14, 1000, out.ref(2, 1), col); //0.01413008627 -> negligable\n            // alphaBlend(14, 1000, out.ref(1, 2), col); //0.01413008627\n        }\n    }\n\n    class Scale4x {\n        _SCALE = 4\n\n        Scale() {\n            return this._SCALE\n        }\n\n        BlendLineShallow(color, out) {\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 1, 0), out, color)\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 2, 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 1, 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 2, 3), out, color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 2), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 3), color)\n        }\n\n        BlendLineSteep(color, out) {\n            _AlphaBlend(1, 4, out.Reference(0, this._SCALE - 1), out, color)\n            _AlphaBlend(1, 4, out.Reference(2, this._SCALE - 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(1, this._SCALE - 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(3, this._SCALE - 2), out, color)\n            out.SetDstPixel(out.Reference(2, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(3, this._SCALE - 1), color)\n        }\n\n        BlendLineSteepAndShallow(color, out) {\n            _AlphaBlend(3, 4, out.Reference(3, 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(1, 3), out, color)\n            _AlphaBlend(1, 4, out.Reference(3, 0), out, color)\n            _AlphaBlend(1, 4, out.Reference(0, 3), out, color)\n            _AlphaBlend(1, 3, out.Reference(2, 2), out, color)\n            out.SetDstPixel(out.Reference(3, 3), color)\n            out.SetDstPixel(out.Reference(3, 2), color)\n            out.SetDstPixel(out.Reference(2, 3), color)\n        }\n\n        BlendLineDiagonal(color, out) {\n            // number\n            _AlphaBlend(\n                1,\n                2,\n                out.Reference(this._SCALE - 1, Math.floor(this._SCALE / 2)),\n                out,\n                color\n            )\n            _AlphaBlend(\n                1,\n                2,\n                out.Reference(this._SCALE - 2, Math.floor(this._SCALE / 2) + 1),\n                out,\n                color\n            )\n            out.SetDstPixel(out.Reference(this._SCALE - 1, this._SCALE - 1), color)\n        }\n\n        BlendCorner(color, out) {\n            // \n            _AlphaBlend(68, 100, out.Reference(3, 3), out, color) // exact: 0.6848532563\n            _AlphaBlend(9, 100, out.Reference(3, 2), out, color) // 0.08677704501\n            _AlphaBlend(9, 100, out.Reference(2, 3), out, color) // 0.08677704501\n        }\n    }\n\n    class Scale5x {\n        _SCALE = 5\n\n        Scale() {\n            return this._SCALE\n        }\n\n        BlendLineShallow(color, out) {\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 1, 0), out, color)\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 2, 2), out, color)\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 3, 4), out, color)\n\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 1, 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 2, 3), out, color)\n\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 2), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 3), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 4), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 2, 4), color)\n        }\n\n        BlendLineSteep(color, out) {\n            _AlphaBlend(1, 4, out.Reference(0, this._SCALE - 1), out, color)\n            _AlphaBlend(1, 4, out.Reference(2, this._SCALE - 2), out, color)\n            _AlphaBlend(1, 4, out.Reference(4, this._SCALE - 3), out, color)\n\n            _AlphaBlend(3, 4, out.Reference(1, this._SCALE - 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(3, this._SCALE - 2), out, color)\n\n            out.SetDstPixel(out.Reference(2, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(3, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(4, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(4, this._SCALE - 2), color)\n        }\n\n        BlendLineSteepAndShallow(color, out) {\n            _AlphaBlend(1, 4, out.Reference(0, this._SCALE - 1), out, color)\n            _AlphaBlend(1, 4, out.Reference(2, this._SCALE - 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(1, this._SCALE - 1), out, color)\n\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 1, 0), out, color)\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 2, 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 1, 1), out, color)\n\n            _AlphaBlend(2, 3, out.Reference(3, 3), out, color)\n\n            out.SetDstPixel(out.Reference(2, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(3, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(4, this._SCALE - 1), color)\n\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 2), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 3), color)\n        }\n\n        BlendLineDiagonal(color, out) {\n            // number\n            _AlphaBlend(\n                1,\n                8,\n                out.Reference(this._SCALE - 1, Math.floor(this._SCALE / 2)),\n                out,\n                color\n            )\n            _AlphaBlend(\n                1,\n                8,\n                out.Reference(this._SCALE - 2, Math.floor(this._SCALE / 2) + 1),\n                out,\n                color\n            )\n            _AlphaBlend(\n                1,\n                8,\n                out.Reference(this._SCALE - 3, Math.floor(this._SCALE / 2) + 2),\n                out,\n                color\n            )\n\n            _AlphaBlend(7, 8, out.Reference(4, 3), out, color)\n            _AlphaBlend(7, 8, out.Reference(3, 4), out, color)\n\n            out.SetDstPixel(out.Reference(4, 4), color)\n        }\n\n        BlendCorner(color, out) {\n            // \n            _AlphaBlend(86, 100, out.Reference(4, 4), out, color) // exact: 0.8631434088\n            _AlphaBlend(23, 100, out.Reference(4, 3), out, color) // 0.2306749731\n            _AlphaBlend(23, 100, out.Reference(3, 4), out, color) // 0.2306749731\n            // _AlphaBlend(1, 64, out.Reference(4, 2), out, color) // 0.01676812367 -> negligable\n            // _AlphaBlend(1, 64, out.Reference(2, 4), out, color) // 0.01676812367\n        }\n    }\n\n    class Scale6x {\n        _SCALE = 6\n\n        Scale() {\n            return this._SCALE\n        }\n\n        BlendLineShallow(color, out) {\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 1, 0), out, color)\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 2, 2), out, color)\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 3, 4), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 1, 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 2, 3), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 3, 5), out, color)\n\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 2), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 3), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 4), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 5), color)\n\n            out.SetDstPixel(out.Reference(this._SCALE - 2, 4), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 2, 5), color)\n        }\n\n        BlendLineSteep(color, out) {\n            _AlphaBlend(1, 4, out.Reference(0, this._SCALE - 1), out, color)\n            _AlphaBlend(1, 4, out.Reference(2, this._SCALE - 2), out, color)\n            _AlphaBlend(1, 4, out.Reference(4, this._SCALE - 3), out, color)\n            _AlphaBlend(3, 4, out.Reference(1, this._SCALE - 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(3, this._SCALE - 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(5, this._SCALE - 3), out, color)\n\n            out.SetDstPixel(out.Reference(2, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(3, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(4, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(5, this._SCALE - 1), color)\n\n            out.SetDstPixel(out.Reference(4, this._SCALE - 2), color)\n            out.SetDstPixel(out.Reference(5, this._SCALE - 2), color)\n        }\n\n        BlendLineSteepAndShallow(color, out) {\n            _AlphaBlend(1, 4, out.Reference(0, this._SCALE - 1), out, color)\n            _AlphaBlend(1, 4, out.Reference(2, this._SCALE - 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(1, this._SCALE - 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(3, this._SCALE - 2), out, color)\n\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 1, 0), out, color)\n            _AlphaBlend(1, 4, out.Reference(this._SCALE - 2, 2), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 1, 1), out, color)\n            _AlphaBlend(3, 4, out.Reference(this._SCALE - 2, 3), out, color)\n\n            out.SetDstPixel(out.Reference(2, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(3, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(4, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(5, this._SCALE - 1), color)\n\n            out.SetDstPixel(out.Reference(4, this._SCALE - 2), color)\n            out.SetDstPixel(out.Reference(5, this._SCALE - 2), color)\n\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 2), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, 3), color)\n        }\n\n        BlendLineDiagonal(color, out) {\n            // number\n            _AlphaBlend(\n                1,\n                2,\n                out.Reference(this._SCALE - 1, Math.floor(this._SCALE / 2)),\n                out,\n                color\n            )\n            _AlphaBlend(\n                1,\n                2,\n                out.Reference(this._SCALE - 2, Math.floor(this._SCALE / 2) + 1),\n                out,\n                color\n            )\n            _AlphaBlend(\n                1,\n                2,\n                out.Reference(this._SCALE - 3, Math.floor(this._SCALE / 2) + 2),\n                out,\n                color\n            )\n            out.SetDstPixel(out.Reference(this._SCALE - 2, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, this._SCALE - 1), color)\n            out.SetDstPixel(out.Reference(this._SCALE - 1, this._SCALE - 2), color)\n        }\n\n        BlendCorner(color, out) {\n            // \n            _AlphaBlend(97, 100, out.Reference(5, 5), out, color) // exact: 0.9711013910\n            _AlphaBlend(42, 100, out.Reference(4, 5), out, color) // 0.4236372243\n            _AlphaBlend(42, 100, out.Reference(5, 4), out, color) // 0.4236372243\n            _AlphaBlend(6, 100, out.Reference(5, 3), out, color) // 0.05652034508\n            _AlphaBlend(6, 100, out.Reference(3, 5), out, color) // 0.05652034508\n        }\n    }\n\n    return XBRz.XBRZ(image_data, scale);\n};\n    self.onmessage = function onmessage(event) {\n\n        if (event.data.type === \'imageData\') {\n            const result = xbrzrender(event.data.imageData, event.data.data.scale);\n            self.postMessage([result, event.data.id, event.data.algorithm]);\n        }\n    };\n',functionSize:function(e,t,n){return{width:e*n,height:t*n,arrayBufferLength:e*n*t*n*4}}}}}]);